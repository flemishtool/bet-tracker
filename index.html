<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#0f0f1a">
    <title>21-Day Betting Challenge</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üéØ</text></svg>">
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        *{margin:0;padding:0;box-sizing:border-box}
        :root{--bg1:#0f0f1a;--bg2:#1a1a2e;--bg3:#252542;--green:#00d4aa;--orange:#ff9f43;--red:#ff6b6b;--blue:#54a0ff;--purple:#a55eea;--yellow:#feca57;--text1:#fff;--text2:#a0a0b8;--text3:#6c6c8a;--border:#2d2d4a}
        [data-theme="light"]{--bg1:#f5f7fa;--bg2:#fff;--bg3:#e8ecf1;--text1:#1a1a2e;--text2:#5a5a7a;--text3:#8a8aa8;--border:#d0d5dd}
        body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;background:var(--bg1);color:var(--text1);min-height:100vh;line-height:1.4}
        .app{display:flex;min-height:100vh}
        .main{flex:1;padding:10px;padding-bottom:70px;overflow-x:hidden}
        .sidebar{width:320px;background:var(--bg2);border-left:1px solid var(--border);padding:10px;position:fixed;right:0;top:0;bottom:0;overflow-y:auto;z-index:50;display:none}
        @media(min-width:1200px){.main{margin-right:320px;padding-bottom:15px}.sidebar{display:block}.mob-toggle,.mob-panel{display:none!important}}
        .header{display:flex;justify-content:space-between;align-items:center;padding:10px 0;border-bottom:2px solid var(--border);margin-bottom:12px;flex-wrap:wrap;gap:10px}
        .header-left{display:flex;align-items:center;gap:10px;flex-wrap:wrap}
        .header h1{font-size:1.1rem;background:linear-gradient(135deg,var(--green),var(--blue));-webkit-background-clip:text;-webkit-text-fill-color:transparent}
        .header-ctrl{display:flex;align-items:center;gap:6px}
        .badge{display:flex;align-items:center;gap:4px;padding:4px 10px;background:var(--bg3);border-radius:12px;font-size:.6rem}
        .dot{width:6px;height:6px;border-radius:50%}
        .dot.on{background:var(--green)}.dot.wait{background:var(--orange);animation:pulse 1s infinite}.dot.off{background:var(--red)}
        .theme-btn{background:var(--bg3);border:1px solid var(--border);border-radius:12px;padding:4px 10px;cursor:pointer;font-size:.85rem;color:var(--text1)}
        .header-stats{display:flex;gap:12px;flex-wrap:wrap}
        .h-stat{text-align:center}
        .h-stat-val{font-size:.9rem;font-weight:700;color:var(--green)}
        .h-stat-lbl{font-size:.45rem;color:var(--text2);text-transform:uppercase}
        .quick{display:flex;gap:6px;margin-bottom:12px;overflow-x:auto;padding-bottom:5px}
        .q-stat{background:var(--bg2);padding:8px 12px;border-radius:8px;text-align:center;min-width:75px;flex-shrink:0;border:1px solid var(--border)}
        .q-val{font-size:.85rem;font-weight:700}
        .q-lbl{font-size:.45rem;color:var(--text2);text-transform:uppercase;margin-top:2px}
        .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(340px,1fr));gap:10px}
        @media(max-width:768px){.grid{grid-template-columns:1fr}}
        .card{background:var(--bg2);border-radius:10px;padding:12px;border:1px solid var(--border)}
        .card-hdr{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;padding-bottom:8px;border-bottom:1px solid var(--border);flex-wrap:wrap;gap:6px}
        .card-title{font-size:.8rem;font-weight:600}
        .card-act{display:flex;gap:5px;align-items:center}
        .card.full{grid-column:1/-1}
        .filters{display:flex;gap:5px;margin-bottom:8px;flex-wrap:wrap;align-items:center;padding:6px;background:var(--bg3);border-radius:5px;font-size:.65rem}
        .f-grp{display:flex;align-items:center;gap:3px}
        .f-lbl{font-size:.5rem;color:var(--text2);text-transform:uppercase}
        .f-inp,.f-sel,.date-inp{padding:4px 6px;background:var(--bg2);border:1px solid var(--border);border-radius:3px;color:var(--text1);font-size:.65rem}
        .date-inp::-webkit-calendar-picker-indicator{filter:invert(1);cursor:pointer}
        [data-theme="light"] .date-inp::-webkit-calendar-picker-indicator{filter:none}
        .tabs{display:flex;gap:3px;overflow-x:auto;padding:3px 0;margin-bottom:6px}
        .tab{padding:4px 8px;background:var(--bg3);border:1px solid var(--border);border-radius:4px;color:var(--text2);cursor:pointer;font-size:.6rem;white-space:nowrap;flex-shrink:0}
        .tab:hover{background:var(--border)}.tab.active{background:var(--green);color:var(--bg1);border-color:var(--green)}
        .fix-cont{max-height:450px;overflow-y:auto}
        .fix-card{background:var(--bg3);border-radius:6px;padding:8px;margin-bottom:6px;border:2px solid transparent;transition:all .15s}
        .fix-card:hover{border-color:var(--blue)}.fix-card.sel{border-color:var(--orange);background:rgba(255,159,67,.08)}
        .fix-hdr{display:flex;justify-content:space-between;align-items:center;margin-bottom:6px}
        .fix-league{font-size:.55rem;color:var(--blue);font-weight:600}
        .fix-time{font-size:.6rem;color:var(--text2);background:var(--bg2);padding:2px 5px;border-radius:3px}
        .fix-time.live{background:var(--red);color:#fff}
        .fix-teams{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
        .fix-team{display:flex;align-items:center;gap:5px;flex:1;min-width:0}
        .fix-team.away{flex-direction:row-reverse;text-align:right}
        .team-logo{width:22px;height:22px;border-radius:3px;object-fit:contain;background:var(--bg2)}
        .team-name{font-size:.75rem;font-weight:600;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
        .fix-vs{font-size:.65rem;color:var(--text3);padding:0 8px}
        .fix-score{font-size:.95rem;font-weight:700;padding:0 8px;color:var(--green)}
        .odds-sec{margin-top:6px}
        .odds-title{font-size:.45rem;color:var(--text3);text-transform:uppercase;margin-bottom:3px}
        .odds-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:3px}
        .odds-grid.g2{grid-template-columns:repeat(2,1fr)}
        .odds-grid.g4{grid-template-columns:repeat(4,1fr)}
        .odds-grid.g5{grid-template-columns:repeat(5,1fr)}
        .odd-btn{background:var(--bg2);border:1px solid var(--border);border-radius:4px;padding:4px 2px;text-align:center;cursor:pointer;transition:all .1s}
        .odd-btn:hover{border-color:var(--green);background:rgba(0,212,170,.1)}
        .odd-btn.sel{background:var(--green);border-color:var(--green);color:var(--bg1)}
        .odd-lbl{font-size:.4rem;color:var(--text2)}.odd-btn.sel .odd-lbl{color:var(--bg1)}
        .odd-val{font-size:.7rem;font-weight:700}
        .bk-tag{font-size:.4rem;color:var(--text3);text-align:right;margin-top:3px}
        .load-odds{width:100%;margin-top:5px;padding:5px;background:var(--bg2);border:1px dashed var(--border);border-radius:3px;color:var(--text2);cursor:pointer;font-size:.65rem}
        .load-odds:hover{border-color:var(--green);color:var(--green)}
        .slip-hdr{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;padding-bottom:8px;border-bottom:2px solid var(--green)}
        .slip-title{font-size:.85rem;font-weight:600}
        .slip-cnt{background:var(--green);color:var(--bg1);padding:2px 7px;border-radius:8px;font-size:.65rem;margin-left:5px}
        .slip-clr{color:var(--red);cursor:pointer;font-size:.65rem}
        .slip-empty{text-align:center;padding:25px;color:var(--text2)}
        .slip-empty-icon{font-size:1.8rem;margin-bottom:8px;opacity:.5}
        .slip-leg{background:var(--bg3);border-radius:5px;padding:7px;margin-bottom:5px;position:relative}
        .slip-leg-rm{position:absolute;top:5px;right:5px;background:var(--red);border:none;border-radius:50%;width:15px;height:15px;color:#fff;cursor:pointer;font-size:.55rem;display:flex;align-items:center;justify-content:center}
        .slip-leg-match{font-size:.55rem;color:var(--text2);margin-bottom:2px;padding-right:18px}
        .slip-leg-sel{font-size:.7rem;font-weight:600;margin-bottom:2px}
        .slip-leg-odds{width:50px;padding:2px 4px;background:var(--bg2);border:1px solid var(--border);border-radius:3px;color:var(--green);font-weight:700;font-size:.7rem;text-align:center}
        .slip-sum{background:var(--bg3);border-radius:6px;padding:8px;margin-top:8px}
        .slip-row{display:flex;justify-content:space-between;align-items:center;margin-bottom:4px;font-size:.7rem}
        .slip-row.total{font-weight:700;margin-top:6px;padding-top:6px;border-top:1px solid var(--border)}
        .slip-stake{width:70px;padding:4px;background:var(--bg2);border:1px solid var(--border);border-radius:4px;color:var(--text1);font-size:.75rem;text-align:right}
        .stake-pre{display:flex;gap:2px;margin-top:5px}
        .stake-pre-btn{flex:1;padding:3px;background:var(--bg2);border:1px solid var(--border);border-radius:2px;color:var(--text2);font-size:.5rem;cursor:pointer;text-align:center}
        .stake-pre-btn:hover{border-color:var(--green);color:var(--green)}
        .conf-btns{display:flex;gap:3px;margin-top:6px}
        .conf-btn{flex:1;padding:4px;border:1px solid var(--border);border-radius:4px;background:var(--bg2);color:var(--text2);font-size:.55rem;cursor:pointer;text-align:center}
        .conf-btn.active.low{border-color:var(--red);color:var(--red)}
        .conf-btn.active.med{border-color:var(--orange);color:var(--orange)}
        .conf-btn.active.high{border-color:var(--green);color:var(--green)}
        .slip-submit{width:100%;padding:9px;background:linear-gradient(135deg,var(--green),var(--blue));border:none;border-radius:6px;color:#fff;font-weight:700;font-size:.8rem;cursor:pointer;margin-top:7px}
        .slip-submit:disabled{opacity:.5;cursor:not-allowed}
        .mob-toggle{position:fixed;bottom:12px;right:12px;background:linear-gradient(135deg,var(--green),var(--blue));color:#fff;border:none;border-radius:20px;padding:9px 16px;font-weight:700;cursor:pointer;z-index:100;display:flex;align-items:center;gap:6px;box-shadow:0 3px 12px rgba(0,212,170,.4);font-size:.75rem}
        .mob-toggle .cnt{background:#fff;color:var(--bg1);border-radius:50%;width:18px;height:18px;display:flex;align-items:center;justify-content:center;font-size:.65rem}
        .mob-panel{position:fixed;bottom:0;left:0;right:0;background:var(--bg2);border-top:2px solid var(--green);padding:10px;z-index:99;transform:translateY(100%);transition:transform .3s;max-height:65vh;overflow-y:auto;border-radius:12px 12px 0 0}
        .mob-panel.open{transform:translateY(0)}
        .prog-bar{height:18px;background:var(--bg3);border-radius:9px;overflow:hidden;margin:8px 0}
        .prog-fill{height:100%;background:linear-gradient(90deg,var(--green),var(--blue));border-radius:9px;display:flex;align-items:center;justify-content:center;font-size:.6rem;font-weight:700;min-width:35px}
        .streak{display:flex;gap:3px;flex-wrap:wrap;margin:8px 0}
        .streak-day{width:20px;height:20px;border-radius:3px;display:flex;align-items:center;justify-content:center;font-size:.5rem;font-weight:700}
        .streak-won{background:var(--green);color:var(--bg1)}
        .streak-lost{background:var(--red);color:#fff}
        .streak-pend{background:var(--bg3);color:var(--text3);border:1px dashed var(--border)}
        .streak-cur{border:2px solid #fff!important;box-shadow:0 0 6px rgba(255,255,255,.3)}
        .metrics{display:grid;grid-template-columns:repeat(2,1fr);gap:6px}
        .metric{background:var(--bg3);padding:8px;border-radius:5px;text-align:center}
        .metric-val{font-size:1rem;font-weight:700}
        .metric-lbl{font-size:.45rem;color:var(--text2);text-transform:uppercase}
        .strat-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:6px}
        .strat-item{background:var(--bg3);padding:8px;border-radius:5px;text-align:center}
        .strat-val{font-size:.9rem;font-weight:700}
        .strat-lbl{font-size:.45rem;color:var(--text2);text-transform:uppercase}
        .strat-tip{background:rgba(0,212,170,.1);border:1px solid var(--green);border-radius:5px;padding:8px;margin-top:8px;font-size:.65rem}
        .strat-tip-title{color:var(--green);font-weight:600;margin-bottom:3px;font-size:.6rem}
        .miles-list{max-height:220px;overflow-y:auto}
        .mile-item{display:flex;align-items:center;gap:7px;padding:6px;background:var(--bg3);border-radius:5px;margin-bottom:4px}
        .mile-item.done{background:rgba(0,212,170,.12);border:1px solid var(--green)}
        .mile-chk{width:22px;height:22px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:.55rem}
        .mile-chk.pend{background:var(--bg2);color:var(--text3);border:1px dashed var(--border)}
        .mile-chk.done{background:var(--green);color:var(--bg1)}
        .mile-amt{font-weight:700;font-size:.75rem}
        .mile-lbl{font-size:.5rem;color:var(--text2)}
        .targs-list{max-height:180px;overflow-y:auto}
        .targ-row{display:flex;justify-content:space-between;padding:5px 7px;background:var(--bg3);border-radius:4px;margin-bottom:3px;font-size:.65rem}
        .targ-row.cur{border:1px solid var(--orange)}
        .prob-disp{text-align:center;padding:12px}
        .prob-val{font-size:1.8rem;font-weight:700;background:linear-gradient(135deg,var(--green),var(--blue));-webkit-background-clip:text;-webkit-text-fill-color:transparent}
        .prob-lbl{font-size:.6rem;color:var(--text2)}
        .prob-stats{display:grid;grid-template-columns:repeat(2,1fr);gap:5px;margin-top:8px}
        .prob-stat{background:var(--bg3);padding:7px;border-radius:5px;text-align:center}
        .prob-stat-val{font-size:.8rem;font-weight:700}
        .prob-stat-lbl{font-size:.4rem;color:var(--text2);text-transform:uppercase}
        .risk-bar{height:7px;background:linear-gradient(90deg,var(--green),var(--yellow),var(--orange),var(--red));border-radius:3px;position:relative;margin:12px 0 4px}
        .risk-ind{position:absolute;top:-3px;width:13px;height:13px;background:#fff;border-radius:50%;border:2px solid var(--bg1);transform:translateX(-50%);box-shadow:0 2px 4px rgba(0,0,0,.3)}
        .analytics{display:grid;grid-template-columns:repeat(2,1fr);gap:5px}
        .anal-item{background:var(--bg3);padding:7px;border-radius:5px}
        .anal-lbl{font-size:.45rem;color:var(--text2);text-transform:uppercase}
        .anal-val{font-size:.8rem;font-weight:700}
        .mkt-stats{margin-top:8px}
        .mkt-row{display:flex;align-items:center;gap:5px;padding:3px 0;border-bottom:1px solid var(--border);font-size:.6rem}
        .mkt-name{flex:1}
        .mkt-bar{flex:2;height:4px;background:var(--bg2);border-radius:2px;overflow:hidden}
        .mkt-bar-fill{height:100%;border-radius:2px}
        .mkt-stat{min-width:30px;text-align:right;font-weight:700}
        .day-perf{display:flex;gap:2px;margin-top:8px;align-items:flex-end;height:50px}
        .day-bar-w{flex:1;display:flex;flex-direction:column;align-items:center;gap:1px}
        .day-bar{width:100%;background:var(--bg2);border-radius:2px;position:relative;min-height:2px}
        .day-bar-fill{position:absolute;bottom:0;left:0;right:0;border-radius:2px}
        .day-bar-lbl{font-size:.35rem;color:var(--text3)}
        .pend-bet{background:var(--bg3);border-radius:6px;padding:8px;margin-bottom:6px}
        .pend-hdr{display:flex;justify-content:space-between;margin-bottom:5px}
        .pend-leg{padding:3px 0;border-bottom:1px solid var(--border);font-size:.65rem}
        .pend-leg:last-child{border-bottom:none}
        .pend-sum{display:flex;justify-content:space-between;font-size:.65rem;margin-top:5px;padding-top:5px;border-top:1px solid var(--border)}
        .btn{padding:5px 10px;border:none;border-radius:4px;font-size:.65rem;font-weight:600;cursor:pointer}
        .btn-primary{background:linear-gradient(135deg,var(--green),var(--blue));color:#fff}
        .btn-secondary{background:var(--bg3);color:var(--text1);border:1px solid var(--border)}
        .btn-success{background:var(--green);color:var(--bg1)}
        .btn-danger{background:var(--red);color:#fff}
        .btn-sm{padding:3px 7px;font-size:.6rem}
        .btn-grp{display:flex;gap:4px;margin-top:5px}
        .btn-grp .btn{flex:1}
        .modal-ov{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,.85);display:none;align-items:center;justify-content:center;z-index:200;padding:12px}
        .modal-ov.open{display:flex}
        .modal{background:var(--bg2);border-radius:10px;padding:14px;max-width:380px;width:100%;max-height:75vh;overflow-y:auto}
        .modal-hdr{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;padding-bottom:8px;border-bottom:1px solid var(--border)}
        .modal-title{font-size:.9rem;font-weight:600}
        .modal-close{background:none;border:none;color:var(--text2);font-size:1.2rem;cursor:pointer}
        .form-grp{margin-bottom:8px}
        .form-lbl{display:block;font-size:.65rem;color:var(--text2);margin-bottom:3px}
        .form-inp{width:100%;padding:7px 9px;background:var(--bg3);border:1px solid var(--border);border-radius:5px;color:var(--text1);font-size:.75rem}
        .tbl-cont{overflow-x:auto;max-height:280px}
        table{width:100%;border-collapse:collapse}
        th,td{padding:6px 4px;text-align:left;font-size:.55rem;border-bottom:1px solid var(--border)}
        th{background:var(--bg3);font-size:.45rem;text-transform:uppercase;color:var(--text2);position:sticky;top:0}
        .badge{padding:2px 5px;border-radius:6px;font-size:.45rem;font-weight:600;text-transform:uppercase}
        .badge-pend{background:rgba(255,159,67,.2);color:var(--orange)}
        .badge-won{background:rgba(0,212,170,.2);color:var(--green)}
        .badge-lost{background:rgba(255,107,107,.2);color:var(--red)}
        .badge-low{background:rgba(255,107,107,.2);color:var(--red)}
        .badge-med{background:rgba(255,159,67,.2);color:var(--orange)}
        .badge-high{background:rgba(0,212,170,.2);color:var(--green)}
        .chart-cont{height:140px}
        .green{color:var(--green)}.red{color:var(--red)}.orange{color:var(--orange)}.blue{color:var(--blue)}.text-muted{color:var(--text3)}.mt-1{margin-top:5px}
        .empty{text-align:center;padding:18px;color:var(--text2)}
        .empty-icon{font-size:1.6rem;margin-bottom:6px;opacity:.5}
        .loading{display:flex;justify-content:center;align-items:center;padding:25px}
        .spinner{width:26px;height:26px;border:3px solid var(--bg3);border-top-color:var(--green);border-radius:50%;animation:spin 1s linear infinite}
        @keyframes spin{to{transform:rotate(360deg)}}
        @keyframes pulse{0%,100%{opacity:1}50%{opacity:.5}}
        .notif{position:fixed;top:8px;left:8px;right:8px;padding:9px 12px;border-radius:7px;color:#fff;font-weight:600;z-index:300;font-size:.7rem;text-align:center;animation:slideD .3s}
        @keyframes slideD{from{transform:translateY(-100%);opacity:0}to{transform:translateY(0);opacity:1}}
        .notif-success{background:var(--green);color:var(--bg1)}
        .notif-error{background:var(--red)}
        .notif-warning{background:var(--orange);color:var(--bg1)}
        .notif-info{background:var(--blue)}
        ::-webkit-scrollbar{width:4px;height:4px}
        ::-webkit-scrollbar-thumb{background:var(--border);border-radius:2px}
        @media(max-width:768px){.header{flex-direction:column;text-align:center}.filters{flex-direction:column;align-items:stretch}}
    </style>
</head>
<body>
<div class="app">
<div class="main">
    <div class="header">
        <div class="header-left">
            <h1>üéØ 21-Day Challenge</h1>
            <div class="header-ctrl">
                <div class="badge"><div class="dot wait" id="fbDot"></div><span id="fbTxt">Connecting</span></div>
                <div class="badge"><div class="dot" id="apiDot"></div><span id="apiTxt">API</span></div>
                <button class="theme-btn" onclick="toggleTheme()" id="themeBtn">üåô</button>
            </div>
        </div>
        <div class="header-stats">
            <div class="h-stat"><div class="h-stat-val" id="hDay">Day 3</div><div class="h-stat-lbl">Day</div></div>
            <div class="h-stat"><div class="h-stat-val" id="hBal">¬£384</div><div class="h-stat-lbl">Balance</div></div>
            <div class="h-stat"><div class="h-stat-val green" id="hWin">100%</div><div class="h-stat-lbl">Win</div></div>
            <div class="h-stat"><div class="h-stat-val" id="hStat">üü¢</div><div class="h-stat-lbl">Status</div></div>
        </div>
    </div>
    <div class="quick">
        <div class="q-stat"><div class="q-val green" id="qProf">¬£184</div><div class="q-lbl">Profit</div></div>
        <div class="q-stat"><div class="q-val blue" id="qTarg">¬£346</div><div class="q-lbl">Target</div></div>
        <div class="q-stat"><div class="q-val orange" id="qVs">+¬£38</div><div class="q-lbl">vs Targ</div></div>
        <div class="q-stat"><div class="q-val" id="qOdds">1.39</div><div class="q-lbl">Avg</div></div>
        <div class="q-stat"><div class="q-val" id="qLeft">19</div><div class="q-lbl">Left</div></div>
        <div class="q-stat"><div class="q-val" id="qROI">92%</div><div class="q-lbl">ROI</div></div>
    </div>
    <div class="grid">
        <div class="card">
            <div class="card-hdr">
                <span class="card-title">‚öΩ Fixtures</span>
                <div class="card-act"><span class="text-muted" id="fixCnt">0</span><button class="btn btn-sm btn-secondary" onclick="loadFix()">üîÑ</button></div>
            </div>
            <div class="filters">
                <div class="f-grp"><span class="f-lbl">Date:</span><input type="date" class="date-inp" id="dateF"><button class="btn btn-sm btn-primary" onclick="loadDate()">Go</button></div>
                <div class="f-grp"><span class="f-lbl">Status:</span><select class="f-sel" id="statF" onchange="doFilter()"><option value="all">All</option><option value="upcoming" selected>Upcoming</option><option value="live">Live</option><option value="fin">Finished</option></select></div>
                <div class="f-grp"><span class="f-lbl">Odds:</span><input type="number" class="f-inp" id="minO" placeholder="Min" style="width:45px" onchange="doFilter()"><input type="number" class="f-inp" id="maxO" placeholder="Max" style="width:45px" onchange="doFilter()"></div>
                <div class="f-grp"><span class="f-lbl">Sort:</span><select class="f-sel" id="sortF" onchange="doFilter()"><option value="time">Time</option><option value="oddsL">Odds‚Üë</option><option value="oddsH">Odds‚Üì</option><option value="league">League</option></select></div>
                <button class="btn btn-sm btn-secondary" onclick="clrFilter()">Clear</button>
            </div>
            <div class="tabs" id="tabs"></div>
            <div class="fix-cont" id="fixCont"><div class="loading"><div class="spinner"></div></div></div>
        </div>
        <div class="card">
            <div class="card-hdr"><span class="card-title">üìà Progress</span></div>
            <div style="display:flex;justify-content:space-between;font-size:.65rem;margin-bottom:4px"><span>Progress to ¬£9,201</span><span class="green" id="progPct">4.2%</span></div>
            <div class="prog-bar"><div class="prog-fill" id="progFill" style="width:4.2%">4.2%</div></div>
            <div class="streak" id="streak"></div>
            <div class="metrics">
                <div class="metric"><div class="metric-val green" id="mWin">2</div><div class="metric-lbl">Wins</div></div>
                <div class="metric"><div class="metric-val red" id="mLoss">0</div><div class="metric-lbl">Losses</div></div>
                <div class="metric"><div class="metric-val blue" id="mBest">Day 2</div><div class="metric-lbl">Best</div></div>
                <div class="metric"><div class="metric-val orange" id="mStrk">2</div><div class="metric-lbl">Streak</div></div>
            </div>
        </div>
        <div class="card">
            <div class="card-hdr"><span class="card-title">‚è≥ Pending</span></div>
            <div id="pendCont"><div class="empty"><div class="empty-icon">üì≠</div><p>No pending bets</p></div></div>
        </div>
        <div class="card">
            <div class="card-hdr"><span class="card-title">üéØ Strategy</span></div>
            <div class="strat-grid">
                <div class="strat-item"><div class="strat-val green" id="sStk">¬£384</div><div class="strat-lbl">Stake</div></div>
                <div class="strat-item"><div class="strat-val blue" id="sOdds">1.20</div><div class="strat-lbl">Min Odds</div></div>
                <div class="strat-item"><div class="strat-val orange" id="sTrg">¬£461</div><div class="strat-lbl">Target</div></div>
                <div class="strat-item"><div class="strat-val" id="sNeed">¬£77</div><div class="strat-lbl">Need</div></div>
            </div>
            <div class="strat-tip"><div class="strat-tip-title">üí° Tip</div><div id="sTip">Look for safe picks at 1.25-1.35 odds.</div></div>
        </div>
        <div class="card">
            <div class="card-hdr"><span class="card-title">üèÜ Milestones</span></div>
            <div class="miles-list" id="miles"></div>
        </div>
        <div class="card">
            <div class="card-hdr"><span class="card-title">üéØ Targets</span></div>
            <div class="targs-list" id="targs"></div>
        </div>
        <div class="card">
            <div class="card-hdr"><span class="card-title">üìä Probability</span></div>
            <div class="prob-disp"><div class="prob-val" id="prob">2.8%</div><div class="prob-lbl">Success chance</div></div>
            <div class="prob-stats">
                <div class="prob-stat"><div class="prob-stat-val" id="pLeft">19</div><div class="prob-stat-lbl">Left</div></div>
                <div class="prob-stat"><div class="prob-stat-val" id="pNeed">19/19</div><div class="prob-stat-lbl">Need</div></div>
                <div class="prob-stat"><div class="prob-stat-val" id="pImpl">83%</div><div class="prob-stat-lbl">@1.20</div></div>
                <div class="prob-stat"><div class="prob-stat-val" id="pKelly">Full</div><div class="prob-stat-lbl">Kelly</div></div>
            </div>
            <div class="risk-bar"><div class="risk-ind" id="riskInd" style="left:70%"></div></div>
            <div style="display:flex;justify-content:space-between;font-size:.4rem;color:var(--text3)"><span>Low</span><span>Med</span><span>High</span><span>Max</span></div>
        </div>
        <div class="card">
            <div class="card-hdr"><span class="card-title">üìâ Analytics</span></div>
            <div class="analytics">
                <div class="anal-item"><div class="anal-lbl">ROI</div><div class="anal-val green" id="aROI">92%</div></div>
                <div class="anal-item"><div class="anal-lbl">Avg Stk</div><div class="anal-val" id="aStk">¬£229</div></div>
                <div class="anal-item"><div class="anal-lbl">Best Mkt</div><div class="anal-val" id="aMkt">Home</div></div>
                <div class="anal-item"><div class="anal-lbl">Best Comp</div><div class="anal-val" id="aComp">EFL</div></div>
                <div class="anal-item"><div class="anal-lbl">Hi Conf</div><div class="anal-val" id="aConf">100%</div></div>
                <div class="anal-item"><div class="anal-lbl">Opt Odds</div><div class="anal-val" id="aOpt">1.2-1.5</div></div>
            </div>
            <div class="mkt-stats" id="mktStats"></div>
            <div class="day-perf" id="dayPerf"></div>
        </div>
        <div class="card">
            <div class="card-hdr"><span class="card-title">üìà Chart</span></div>
            <div class="chart-cont"><canvas id="chart"></canvas></div>
        </div>
        <div class="card full">
            <div class="card-hdr">
                <span class="card-title">üìú History</span>
                <div class="card-act">
                    <button class="btn btn-sm btn-secondary" onclick="expData()">Export</button>
                    <button class="btn btn-sm btn-secondary" onclick="document.getElementById('impFile').click()">Import</button>
                    <input type="file" id="impFile" accept=".json" style="display:none" onchange="impData(event)">
                    <button class="btn btn-sm btn-danger" onclick="rstData()">Reset</button>
                </div>
            </div>
            <div class="tbl-cont">
                <table><thead><tr><th>Day</th><th>Date</th><th>Selection</th><th>Type</th><th>Conf</th><th>Odds</th><th>Stake</th><th>Result</th><th>Return</th><th>Bal</th><th>vs Targ</th></tr></thead><tbody id="histBody"></tbody></table>
            </div>
        </div>
    </div>
</div>
<div class="sidebar">
    <div class="slip-hdr"><span class="slip-title">üé´ Betslip<span class="slip-cnt" id="dCnt">0</span></span><span class="slip-clr" onclick="clrSlip()">Clear</span></div>
    <div id="dSlip"></div>
</div>
</div>
<button class="mob-toggle" onclick="togMob()">üé´<span class="cnt" id="mCnt">0</span></button>
<div class="mob-panel" id="mobPanel">
    <div class="slip-hdr"><span class="slip-title">üé´ Betslip<span class="slip-cnt" id="mCntIn">0</span></span><span class="slip-clr" onclick="clrSlip()">Clear</span></div>
    <div id="mSlip"></div>
</div>
<div class="modal-ov" id="resModal">
    <div class="modal">
        <div class="modal-hdr"><span class="modal-title">Record Result</span><button class="modal-close" onclick="closeRes()">&times;</button></div>
        <div id="modDet"></div>
        <div class="form-grp"><label class="form-lbl">Final Score</label><input type="text" class="form-inp" id="modScore" placeholder="e.g., 2-1"></div>
        <div class="btn-grp"><button class="btn btn-success" onclick="recRes('won')">‚úÖ Won</button><button class="btn btn-danger" onclick="recRes('lost')">‚ùå Lost</button></div>
        <button class="btn btn-secondary mt-1" onclick="recRes('void')" style="width:100%">‚ö™ Void</button>
    </div>
</div>
<script>
const FB={apiKey:"AIzaSyD-MH_oSRLM53UHe2sPB4bXRjsEcXEm9IM",authDomain:"bet-tracker-d819b.firebaseapp.com",databaseURL:"https://bet-tracker-d819b-default-rtdb.europe-west1.firebasedatabase.app",projectId:"bet-tracker-d819b"};
const AKEY='89d2f65b7dc64f8d0fce8468e2a8af2b',ABASE='https://v3.football.api-sports.io';
const INIT=200,MULT=1.2,DAYS=21,FINAL=INIT*Math.pow(MULT,DAYS);
const MILES=[{a:250,l:'First',e:'üå±'},{a:500,l:'500',e:'üí´'},{a:1000,l:'1K',e:'üéØ'},{a:2000,l:'2K',e:'üî•'},{a:3000,l:'3K',e:'‚ö°'},{a:5000,l:'5K',e:'üöÄ'},{a:7500,l:'7.5K',e:'üåü'},{a:9201,l:'Done!',e:'üèÜ'}];
const LGS={39:{n:'EPL',s:'EPL',f:'üè¥Û†ÅßÛ†Å¢Û†Å•Û†ÅÆÛ†ÅßÛ†Åø',p:1},40:{n:'Champ',s:'CH',f:'üè¥Û†ÅßÛ†Å¢Û†Å•Û†ÅÆÛ†ÅßÛ†Åø',p:6},45:{n:'FA Cup',s:'FA',f:'üèÜ',p:25},48:{n:'EFL Cup',s:'EFL',f:'üèÜ',p:26},140:{n:'La Liga',s:'LL',f:'üá™üá∏',p:2},143:{n:'Copa',s:'Copa',f:'üèÜ',p:27},78:{n:'Bundesliga',s:'BL',f:'üá©üá™',p:3},81:{n:'DFB',s:'DFB',f:'üèÜ',p:28},135:{n:'Serie A',s:'SA',f:'üáÆüáπ',p:4},137:{n:'Coppa',s:'CIT',f:'üèÜ',p:29},61:{n:'Ligue 1',s:'L1',f:'üá´üá∑',p:5},94:{n:'Portugal',s:'PT',f:'üáµüáπ',p:11},88:{n:'Erediv',s:'NL',f:'üá≥üá±',p:12},144:{n:'Belgium',s:'BE',f:'üáßüá™',p:13},203:{n:'Turkey',s:'TR',f:'üáπüá∑',p:14},179:{n:'Scotland',s:'SC',f:'üè¥Û†ÅßÛ†Å¢Û†Å≥Û†Å£Û†Å¥Û†Åø',p:15},307:{n:'Saudi',s:'SA',f:'üá∏üá¶',p:22},2:{n:'UCL',s:'UCL',f:'üèÜ',p:40},3:{n:'UEL',s:'UEL',f:'üèÜ',p:41},848:{n:'UECL',s:'UECL',f:'üèÜ',p:42}};
const FETCH=[39,140,78,135,61,48,45,143,81,137,2,3,848,40,94,88,144,203,179,307];
const MKT={home:'Home',draw:'Draw',away:'Away',homeOrDraw:'1X',awayOrDraw:'X2',homeOrAway:'12',over15:'O1.5',over25:'O2.5',under25:'U2.5',bttsYes:'BTTS Y',bttsNo:'BTTS N'};
const BKS=['Coral','Bet365','Ladbrokes','William Hill','Betfair'];

let db=null,uid=null,online=false,loading=false;
let allFix=[],filtFix=[],oddsC={},slip=[],curLg='all',selBet=null,selConf='med';
let D={startDate:"2025-12-15",currentBalance:384.42,bets:[
{id:1,date:"2025-12-15",type:"single",legs:[{match:"Fenerbahce vs Konyaspor",selection:"Home Win",odds:1.2857,league:"Turkish Super Lig",market:"home"}],selection:"Fenerbahce",competition:"Turkey",odds:1.2857,stake:200,confidence:"high",status:"won",finalScore:"4-0",day:1,returns:257.14,balanceAfter:257.14,targetForDay:240,vsTarget:17.14},
{id:2,date:"2025-12-16",type:"double",legs:[{match:"Cardiff vs Chelsea",selection:"Away",odds:1.30,league:"EFL Cup",market:"away"},{match:"Guadalajara vs Barcelona",selection:"Away",odds:1.15,league:"Copa",market:"away"}],selection:"Chelsea+Barca",competition:"EFL/Copa",odds:1.495,stake:257.14,confidence:"high",status:"won",finalScore:"1-5,0-4",day:2,returns:384.42,balanceAfter:384.42,targetForDay:288,vsTarget:96.42}
],pendingBets:[],settings:{theme:'dark'},lastUpdated:Date.now()};

const sleep=ms=>new Promise(r=>setTimeout(r,ms));
const today=()=>new Date().toISOString().split('T')[0];
const fmt=n=>`¬£${n.toFixed(2)}`;
const targ=d=>INIT*Math.pow(MULT,d);

function notify(m,t='info'){document.querySelectorAll('.notif').forEach(n=>n.remove());const e=document.createElement('div');e.className=`notif notif-${t}`;e.textContent=m;document.body.appendChild(e);setTimeout(()=>e.remove(),3000);}

function toggleTheme(){const t=document.documentElement.getAttribute('data-theme')==='light'?'dark':'light';document.documentElement.setAttribute('data-theme',t);document.getElementById('themeBtn').textContent=t==='light'?'‚òÄÔ∏è':'üåô';localStorage.setItem('theme',t);}
function loadTheme(){const t=localStorage.getItem('theme')||'dark';document.documentElement.setAttribute('data-theme',t);document.getElementById('themeBtn').textContent=t==='light'?'‚òÄÔ∏è':'üåô';}

function initFB(){try{firebase.initializeApp(FB);db=firebase.database();uid=localStorage.getItem('uid')||('u_'+Date.now());localStorage.setItem('uid',uid);db.ref(`c/${uid}`).on('value',s=>{const d=s.val();if(d&&d.lastUpdated>(D.lastUpdated||0)){D=d;updateUI();}online=true;document.getElementById('fbDot').className='dot on';document.getElementById('fbTxt').textContent='Synced';},()=>{document.getElementById('fbDot').className='dot off';document.getElementById('fbTxt').textContent='Offline';});}catch(e){document.getElementById('fbDot').className='dot off';document.getElementById('fbTxt').textContent='Error';}}

function saveD(){D.lastUpdated=Date.now();localStorage.setItem('bd7',JSON.stringify(D));if(db&&uid&&online)db.ref(`c/${uid}`).set(D).catch(()=>{});}
function loadD(){const s=localStorage.getItem('bd7');if(s)try{const p=JSON.parse(s);if(p.bets)D=p;}catch(e){}loadTheme();updateUI();}
function expData(){const b=new Blob([JSON.stringify(D,null,2)],{type:'application/json'});const a=document.createElement('a');a.href=URL.createObjectURL(b);a.download=`bet-${today()}.json`;a.click();notify('Exported!','success');}
function impData(e){const f=e.target.files[0];if(f){const r=new FileReader();r.onload=ev=>{try{D=JSON.parse(ev.target.result);saveD();updateUI();notify('Imported!','success');}catch(err){notify('Failed','error');}};r.readAsText(f);}e.target.value='';}
function rstData(){if(confirm('Reset ALL?')){D={startDate:today(),currentBalance:INIT,bets:[],pendingBets:[],settings:{theme:'dark'},lastUpdated:Date.now()};saveD();updateUI();notify('Reset!','success');}}

async function api(ep){try{const r=await fetch(`${ABASE}${ep}`,{headers:{'x-apisports-key':AKEY}});if(r.ok){const j=await r.json();return j.response||[];}}catch(e){}return[];}

async function loadFix(){
    if(loading)return;
    loading=true;
    document.getElementById('apiDot').className='dot wait';
    document.getElementById('apiTxt').textContent='...';
    document.getElementById('fixCont').innerHTML='<div class="loading"><div class="spinner"></div></div>';
    allFix=[];
    try{
        for(const l of FETCH){
            try{const d=await api(`/fixtures?league=${l}&next=10`);if(d&&d.length)allFix.push(...d);}catch(e){}
            await sleep(120);
        }
        if(allFix.length>0){
            document.getElementById('apiTxt').textContent=allFix.length+' odds';
            await loadOdds();
        }
        document.getElementById('apiDot').className='dot on';
        document.getElementById('apiTxt').textContent=allFix.length+'';
        document.getElementById('fixCnt').textContent=allFix.length;
        doFilter();
    }catch(e){
        document.getElementById('apiDot').className='dot off';
        document.getElementById('apiTxt').textContent='Err';
        document.getElementById('fixCont').innerHTML='<div class="empty"><div class="empty-icon">‚ö†Ô∏è</div><p>Failed to load</p></div>';
    }
    loading=false;
}

async function loadDate(){
    const dt=document.getElementById('dateF').value;
    if(!dt){notify('Pick date','warning');return;}
    if(loading)return;
    loading=true;
    document.getElementById('apiDot').className='dot wait';
    document.getElementById('apiTxt').textContent='...';
    document.getElementById('fixCont').innerHTML='<div class="loading"><div class="spinner"></div></div>';
    allFix=[];
    try{
        for(const l of FETCH){
            try{const d=await api(`/fixtures?league=${l}&date=${dt}`);if(d&&d.length)allFix.push(...d);}catch(e){}
            await sleep(120);
        }
        if(allFix.length>0){
            document.getElementById('apiTxt').textContent=allFix.length+' odds';
            await loadOdds();
        }
        document.getElementById('apiDot').className='dot on';
        document.getElementById('apiTxt').textContent=allFix.length+'';
        document.getElementById('fixCnt').textContent=allFix.length;
        doFilter();
    }catch(e){
        document.getElementById('apiDot').className='dot off';
        document.getElementById('apiTxt').textContent='Err';
        document.getElementById('fixCont').innerHTML='<div class="empty"><div class="empty-icon">‚ö†Ô∏è</div><p>Failed</p></div>';
    }
    loading=false;
}

async function loadOdds(){
    const grp={};
    allFix.forEach(f=>{const k=`${f.league.id}_${f.fixture.date.split('T')[0]}`;if(!grp[k])grp[k]={l:f.league.id,d:f.fixture.date.split('T')[0]};});
    for(const k of Object.keys(grp)){
        const{l,d}=grp[k];
        try{const r=await api(`/odds?league=${l}&date=${d}`);if(r)r.forEach(o=>{oddsC[o.fixture.id]=parseOdds(o);});}catch(e){}
        await sleep(120);
    }
}

function parseOdds(d){
    const res={home:null,draw:null,away:null,homeOrDraw:null,awayOrDraw:null,homeOrAway:null,over15:null,over25:null,under25:null,bttsYes:null,bttsNo:null,bk:null};
    if(!d?.bookmakers?.length)return res;
    let bm=null;for(const p of BKS){bm=d.bookmakers.find(b=>b.name.toLowerCase().includes(p.toLowerCase()));if(bm)break;}
    if(!bm)bm=d.bookmakers[0];
    res.bk=bm.name;
    bm.bets.forEach(b=>{
        if(b.name==='Match Winner')b.values.forEach(v=>{if(v.value==='Home')res.home=+v.odd;if(v.value==='Draw')res.draw=+v.odd;if(v.value==='Away')res.away=+v.odd;});
        if(b.name==='Double Chance')b.values.forEach(v=>{if(v.value==='Home/Draw')res.homeOrDraw=+v.odd;if(v.value==='Away/Draw')res.awayOrDraw=+v.odd;if(v.value==='Home/Away')res.homeOrAway=+v.odd;});
        if(b.name==='Goals Over/Under')b.values.forEach(v=>{if(v.value==='Over 1.5')res.over15=+v.odd;if(v.value==='Over 2.5')res.over25=+v.odd;if(v.value==='Under 2.5')res.under25=+v.odd;});
        if(b.name==='Both Teams Score')b.values.forEach(v=>{if(v.value==='Yes')res.bttsYes=+v.odd;if(v.value==='No')res.bttsNo=+v.odd;});
    });
    return res;
}

async function loadOneOdds(fid){
    notify('Loading...','info');
    try{const r=await api(`/odds?fixture=${fid}`);if(r&&r.length){oddsC[fid]=parseOdds(r[0]);doFilter();notify('Loaded!','success');}else{notify('No odds','warning');}}catch(e){notify('Failed','error');}
}

function doFilter(){
    let fx=[...allFix];
    const st=document.getElementById('statF').value;
    if(st==='upcoming')fx=fx.filter(f=>['NS','TBD','PST'].includes(f.fixture.status.short));
    else if(st==='live')fx=fx.filter(f=>['1H','2H','HT','ET','LIVE'].includes(f.fixture.status.short));
    else if(st==='fin')fx=fx.filter(f=>['FT','AET','PEN'].includes(f.fixture.status.short));
    const minO=parseFloat(document.getElementById('minO').value)||0;
    const maxO=parseFloat(document.getElementById('maxO').value)||999;
    if(minO>0||maxO<999){fx=fx.filter(f=>{const o=oddsC[f.fixture.id];if(!o||!o.home)return true;const mn=Math.min(o.home||99,o.away||99);return mn>=minO&&mn<=maxO;});}
    if(curLg!=='all')fx=fx.filter(f=>f.league.id==curLg);
    const srt=document.getElementById('sortF').value;
    if(srt==='time')fx.sort((a,b)=>new Date(a.fixture.date)-new Date(b.fixture.date));
    else if(srt==='oddsL')fx.sort((a,b)=>{const oA=oddsC[a.fixture.id],oB=oddsC[b.fixture.id];return(oA?Math.min(oA.home||99,oA.away||99):99)-(oB?Math.min(oB.home||99,oB.away||99):99);});
    else if(srt==='oddsH')fx.sort((a,b)=>{const oA=oddsC[a.fixture.id],oB=oddsC[b.fixture.id];return(oB?Math.min(oB.home||99,oB.away||99):0)-(oA?Math.min(oA.home||99,oA.away||99):0);});
    else if(srt==='league')fx.sort((a,b)=>(LGS[a.league.id]?.p||999)-(LGS[b.league.id]?.p||999));
    filtFix=fx;
    buildTabs();
    renderFix();
}

function clrFilter(){document.getElementById('dateF').value='';document.getElementById('statF').value='upcoming';document.getElementById('minO').value='';document.getElementById('maxO').value='';document.getElementById('sortF').value='time';curLg='all';doFilter();}
function setLg(l){curLg=l;doFilter();}

function buildTabs(){
    const lgs=[...new Set(allFix.map(f=>f.league.id))];
    lgs.sort((a,b)=>(LGS[a]?.p||999)-(LGS[b]?.p||999));
    let h=`<div class="tab ${curLg==='all'?'active':''}" onclick="setLg('all')">All(${filtFix.length})</div>`;
    lgs.forEach(l=>{const lg=LGS[l]||{s:'?',f:'‚öΩ'};const c=allFix.filter(f=>f.league.id===l).length;h+=`<div class="tab ${curLg==l?'active':''}" onclick="setLg(${l})">${lg.f}${lg.s}(${c})</div>`;});
    document.getElementById('tabs').innerHTML=h;
}

function renderFix(){
    const cont=document.getElementById('fixCont');
    if(!filtFix.length){cont.innerHTML='<div class="empty"><div class="empty-icon">üìÖ</div><p>No fixtures</p></div>';return;}
    cont.innerHTML=filtFix.map(f=>{
        const fix=f.fixture,tm=f.teams,lg=LGS[f.league.id]||{s:f.league.name?.substr(0,8)||'?',f:'‚öΩ',n:f.league.name};
        const dt=new Date(fix.date),time=dt.toLocaleTimeString('en-GB',{hour:'2-digit',minute:'2-digit'}),date=dt.toLocaleDateString('en-GB',{day:'2-digit',month:'short'});
        const hasSel=slip.some(s=>s.fid===fix.id);
        const odds=oddsC[fix.id];
        const isLive=['1H','2H','HT','ET','LIVE'].includes(fix.status.short);
        const isFin=['FT','AET','PEN'].includes(fix.status.short);
        let mid='<span class="fix-vs">vs</span>';
        if(isLive||isFin)mid=`<span class="fix-score">${f.goals?.home??0}-${f.goals?.away??0}</span>`;
        let timeEl=`<span class="fix-time">${date} ${time}</span>`;
        if(isLive)timeEl=`<span class="fix-time live">üî¥${fix.status.elapsed||''}'</span>`;
        else if(isFin)timeEl=`<span class="fix-time">FT</span>`;
        const h=tm.home.name.replace(/'/g,"\\'"),a=tm.away.name.replace(/'/g,"\\'"),ln=(lg.n||'').replace(/'/g,"\\'");
        return`<div class="fix-card ${hasSel?'sel':''}"><div class="fix-hdr"><span class="fix-league">${lg.f} ${lg.s}</span>${timeEl}</div><div class="fix-teams"><div class="fix-team">${tm.home.logo?`<img src="${tm.home.logo}" class="team-logo" onerror="this.style.display='none'">`:''}}<span class="team-name">${tm.home.name}</span></div>${mid}<div class="fix-team away">${tm.away.logo?`<img src="${tm.away.logo}" class="team-logo" onerror="this.style.display='none'">`:''}}<span class="team-name">${tm.away.name}</span></div></div>${odds?renderOdds(fix.id,odds,h,a,ln):`<button class="load-odds" onclick="loadOneOdds(${fix.id})">üìä Load Odds</button>`}</div>`;
    }).join('');
}

function renderOdds(fid,odds,h,a,lg){
    const sel=m=>slip.some(s=>s.fid===fid&&s.mkt===m)?'sel':'';
    const btn=(m,l,v)=>v?`<div class="odd-btn ${sel(m)}" onclick="togSel(${fid},'${m}','${h}','${a}',${v},'${lg}')"><div class="odd-lbl">${l}</div><div class="odd-val">${v.toFixed(2)}</div></div>`:'';
    let html=`<div class="odds-sec"><div class="odds-title">Result</div><div class="odds-grid">${btn('home','1',odds.home)}${btn('draw','X',odds.draw)}${btn('away','2',odds.away)}</div></div>`;
    if(odds.homeOrDraw||odds.homeOrAway||odds.awayOrDraw)html+=`<div class="odds-sec"><div class="odds-title">Double</div><div class="odds-grid">${btn('homeOrDraw','1X',odds.homeOrDraw)}${btn('homeOrAway','12',odds.homeOrAway)}${btn('awayOrDraw','X2',odds.awayOrDraw)}</div></div>`;
    let goals='';if(odds.over15)goals+=btn('over15','O1.5',odds.over15);if(odds.over25)goals+=btn('over25','O2.5',odds.over25);if(odds.under25)goals+=btn('under25','U2.5',odds.under25);
    if(goals)html+=`<div class="odds-sec"><div class="odds-title">Goals</div><div class="odds-grid">${goals}</div></div>`;
    if(odds.bttsYes||odds.bttsNo)html+=`<div class="odds-sec"><div class="odds-title">BTTS</div><div class="odds-grid g2">${btn('bttsYes','Yes',odds.bttsYes)}${btn('bttsNo','No',odds.bttsNo)}</div></div>`;
    if(odds.bk)html+=`<div class="bk-tag">via ${odds.bk}</div>`;
    return html;
}

function togSel(fid,mkt,h,a,odds,lg){const i=slip.findIndex(s=>s.fid===fid&&s.mkt===mkt);if(i>=0)slip.splice(i,1);else slip.push({fid,mkt,h,a,lg,sel:MKT[mkt]||mkt,odds:+odds.toFixed(2),match:`${h} vs ${a}`});doFilter();renderSlip();}
function updOdds(i,v){const val=parseFloat(v);if(val>1){slip[i].odds=val;renderSlip();}}
function rmLeg(i){slip.splice(i,1);doFilter();renderSlip();}
function clrSlip(){slip=[];doFilter();renderSlip();}
function setConf(c){selConf=c;renderSlip();}
function togMob(){document.getElementById('mobPanel').classList.toggle('open');}
function setStk(p){const s=D.currentBalance*p;document.querySelectorAll('.slip-stake').forEach(e=>e.value=s.toFixed(2));updRet();}

function renderSlip(){
    const html=slipHTML();
    document.getElementById('dSlip').innerHTML=html;
    document.getElementById('mSlip').innerHTML=html;
    document.getElementById('dCnt').textContent=slip.length;
    document.getElementById('mCnt').textContent=slip.length;
    document.getElementById('mCntIn').textContent=slip.length;
    document.querySelectorAll('.slip-stake').forEach(e=>{if(!e.value)e.value=D.currentBalance.toFixed(2);});
}

function slipHTML(){
    if(!slip.length)return'<div class="slip-empty"><div class="slip-empty-icon">üìù</div><p>Click odds to add</p></div>';
    const comb=slip.reduce((a,s)=>a*s.odds,1);
    const type=['','Single','Double','Treble','Acca'][Math.min(slip.length,4)]||'Acca';
    const legs=slip.map((s,i)=>`<div class="slip-leg"><button class="slip-leg-rm" onclick="rmLeg(${i})">√ó</button><div class="slip-leg-match">${s.match}</div><div class="slip-leg-sel">${s.sel}</div><div style="display:flex;align-items:center;gap:4px"><span style="font-size:.55rem;color:var(--text2)">@</span><input type="number" class="slip-leg-odds
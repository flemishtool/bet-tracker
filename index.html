<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Bet Tracker">
    <meta name="theme-color" content="#0f0f1a">
    <link rel="manifest" href="manifest.json">
    <title>21-Day Betting Challenge</title>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        :root {
            --bg-primary: #0f0f1a;
            --bg-secondary: #1a1a2e;
            --bg-tertiary: #252542;
            --accent-green: #00d4aa;
            --accent-orange: #ff9f43;
            --accent-red: #ff6b6b;
            --accent-blue: #54a0ff;
            --accent-purple: #a55eea;
            --accent-yellow: #feca57;
            --text-primary: #ffffff;
            --text-secondary: #b0b0c0;
            --border-color: #333355;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            padding: 10px;
            padding-bottom: 100px;
            line-height: 1.4;
        }

        /* ==================== HEADER ==================== */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 2px solid var(--border-color);
            margin-bottom: 12px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .header h1 {
            font-size: 1.2rem;
            background: linear-gradient(135deg, var(--accent-green), var(--accent-blue));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 12px;
            flex-wrap: wrap;
        }

        .sync-badge {
            display: flex;
            align-items: center;
            gap: 5px;
            padding: 4px 10px;
            background: var(--bg-tertiary);
            border-radius: 15px;
            font-size: 0.65rem;
        }

        .sync-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
        }

        .sync-dot.synced { background: var(--accent-green); }
        .sync-dot.syncing { background: var(--accent-orange); animation: pulse 1s infinite; }
        .sync-dot.offline { background: var(--accent-red); }

        .header-stats {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .header-stat {
            text-align: center;
        }

        .header-stat-value {
            font-size: 1rem;
            font-weight: bold;
            color: var(--accent-green);
        }

        .header-stat-label {
            font-size: 0.55rem;
            color: var(--text-secondary);
            text-transform: uppercase;
        }

        /* ==================== QUICK STATS ==================== */
        .quick-stats {
            display: flex;
            gap: 6px;
            margin-bottom: 12px;
            overflow-x: auto;
            padding-bottom: 6px;
            -webkit-overflow-scrolling: touch;
        }

        .quick-stats::-webkit-scrollbar {
            height: 4px;
        }

        .quick-stats::-webkit-scrollbar-track {
            background: var(--bg-tertiary);
            border-radius: 2px;
        }

        .quick-stats::-webkit-scrollbar-thumb {
            background: var(--border-color);
            border-radius: 2px;
        }

        .quick-stat {
            background: var(--bg-secondary);
            padding: 8px 12px;
            border-radius: 8px;
            text-align: center;
            min-width: 75px;
            flex-shrink: 0;
            border: 1px solid var(--border-color);
        }

        .quick-stat-value {
            font-size: 0.95rem;
            font-weight: bold;
        }

        .quick-stat-label {
            font-size: 0.5rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            margin-top: 2px;
        }

        /* ==================== GRID ==================== */
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 10px;
        }

        /* ==================== CARDS ==================== */
        .card {
            background: var(--bg-secondary);
            border-radius: 10px;
            padding: 12px;
            border: 1px solid var(--border-color);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            padding-bottom: 8px;
            border-bottom: 1px solid var(--border-color);
        }

        .card-title {
            font-size: 0.9rem;
            font-weight: 600;
        }

        .card-actions {
            display: flex;
            gap: 6px;
            align-items: center;
        }

        /* ==================== TABS ==================== */
        .tabs {
            display: flex;
            gap: 4px;
            overflow-x: auto;
            padding-bottom: 8px;
            margin-bottom: 8px;
            -webkit-overflow-scrolling: touch;
        }

        .tabs::-webkit-scrollbar {
            display: none;
        }

        .tab {
            padding: 5px 10px;
            background: var(--bg-tertiary);
            border: none;
            border-radius: 5px;
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 0.65rem;
            white-space: nowrap;
            flex-shrink: 0;
            transition: all 0.2s;
        }

        .tab:hover {
            background: var(--border-color);
        }

        .tab.active {
            background: var(--accent-green);
            color: var(--bg-primary);
        }

        /* ==================== FIXTURES ==================== */
        .fixtures-list {
            max-height: 480px;
            overflow-y: auto;
        }

        .match {
            background: var(--bg-tertiary);
            border-radius: 8px;
            padding: 10px;
            margin-bottom: 8px;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.2s;
        }

        .match:hover {
            border-color: var(--accent-blue);
        }

        .match.in-slip {
            border-color: var(--accent-orange);
            background: rgba(255, 159, 67, 0.1);
        }

        .match-top {
            display: flex;
            justify-content: space-between;
            margin-bottom: 6px;
            font-size: 0.55rem;
        }

        .match-league {
            color: var(--accent-blue);
            font-weight: 600;
            text-transform: uppercase;
        }

        .match-time {
            color: var(--text-secondary);
        }

        .match-teams {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .team {
            display: flex;
            align-items: center;
            gap: 6px;
            flex: 1;
            min-width: 0;
        }

        .team.away {
            flex-direction: row-reverse;
            text-align: right;
        }

        .team-logo {
            width: 22px;
            height: 22px;
            border-radius: 4px;
            object-fit: contain;
            flex-shrink: 0;
        }

        .team-name {
            font-size: 0.75rem;
            font-weight: 600;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .match-vs {
            font-size: 0.75rem;
            padding: 0 10px;
            color: var(--text-secondary);
            flex-shrink: 0;
        }

        /* ==================== ODDS ==================== */
        .odds-row {
            display: flex;
            gap: 4px;
            flex-wrap: wrap;
        }

        .odd {
            flex: 1;
            min-width: 48px;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 5px;
            padding: 5px 3px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
        }

        .odd:hover {
            border-color: var(--accent-green);
            background: rgba(0, 212, 170, 0.1);
        }

        .odd.selected {
            background: var(--accent-green);
            color: var(--bg-primary);
            border-color: var(--accent-green);
        }

        .odd-label {
            font-size: 0.5rem;
            color: var(--text-secondary);
            margin-bottom: 1px;
        }

        .odd.selected .odd-label {
            color: var(--bg-primary);
        }

        .odd-value {
            font-size: 0.75rem;
            font-weight: bold;
        }

        .odd-value.loading {
            color: var(--text-secondary);
        }

        .load-odds-btn {
            width: 100%;
            margin-top: 6px;
        }

        .bookmaker-info {
            font-size: 0.5rem;
            color: var(--text-secondary);
            text-align: right;
            margin-top: 4px;
        }

        /* ==================== BETSLIP ==================== */
        .betslip-btn {
            position: fixed;
            bottom: 15px;
            right: 15px;
            background: linear-gradient(135deg, var(--accent-green), var(--accent-blue));
            color: white;
            border: none;
            border-radius: 25px;
            padding: 12px 20px;
            font-weight: bold;
            cursor: pointer;
            z-index: 100;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 4px 15px rgba(0, 212, 170, 0.4);
            font-size: 0.85rem;
        }

        .betslip-count {
            background: white;
            color: var(--bg-primary);
            border-radius: 50%;
            width: 22px;
            height: 22px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
        }

        .betslip-panel {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--bg-secondary);
            border-top: 2px solid var(--accent-green);
            padding: 12px;
            z-index: 99;
            transform: translateY(100%);
            transition: transform 0.3s ease;
            max-height: 60vh;
            overflow-y: auto;
        }

        .betslip-panel.open {
            transform: translateY(0);
        }

        .slip-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            padding-bottom: 8px;
            border-bottom: 1px solid var(--border-color);
        }

        .slip-title {
            font-weight: 600;
            font-size: 0.9rem;
        }

        .slip-clear {
            color: var(--accent-red);
            cursor: pointer;
            font-size: 0.75rem;
        }

        .slip-leg {
            background: var(--bg-tertiary);
            border-radius: 6px;
            padding: 8px;
            margin-bottom: 6px;
            position: relative;
        }

        .slip-leg-remove {
            position: absolute;
            top: 5px;
            right: 5px;
            background: var(--accent-red);
            border: none;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            color: white;
            cursor: pointer;
            font-size: 0.65rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .slip-leg-match {
            font-size: 0.65rem;
            color: var(--text-secondary);
            margin-bottom: 2px;
        }

        .slip-leg-sel {
            font-size: 0.8rem;
            font-weight: 600;
            margin-bottom: 2px;
        }

        .slip-leg-odds {
            font-size: 0.75rem;
            color: var(--accent-green);
        }

        .slip-summary {
            background: var(--bg-tertiary);
            border-radius: 8px;
            padding: 10px;
            margin-top: 10px;
        }

        .slip-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 6px;
            font-size: 0.8rem;
        }

        .slip-row.total {
            font-weight: bold;
            margin-top: 8px;
            padding-top: 8px;
            border-top: 1px solid var(--border-color);
        }

        .slip-input {
            width: 100px;
            padding: 6px 8px;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 5px;
            color: var(--text-primary);
            text-align: right;
            font-size: 0.85rem;
        }

        .slip-input:focus {
            outline: none;
            border-color: var(--accent-green);
        }

        .slip-submit {
            width: 100%;
            padding: 12px;
            background: linear-gradient(135deg, var(--accent-green), var(--accent-blue));
            border: none;
            border-radius: 8px;
            color: white;
            font-weight: bold;
            font-size: 0.9rem;
            cursor: pointer;
            margin-top: 10px;
        }

        .slip-submit:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* ==================== PROGRESS ==================== */
        .progress-bar {
            height: 20px;
            background: var(--bg-tertiary);
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-green), var(--accent-blue));
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.6rem;
            font-weight: bold;
            min-width: 35px;
            transition: width 0.5s ease;
        }

        /* ==================== STREAK ==================== */
        .streak {
            display: flex;
            gap: 3px;
            flex-wrap: wrap;
            margin: 10px 0;
        }

        .streak-day {
            width: 22px;
            height: 22px;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.55rem;
            font-weight: bold;
        }

        .streak-won {
            background: var(--accent-green);
            color: var(--bg-primary);
        }

        .streak-lost {
            background: var(--accent-red);
            color: white;
        }

        .streak-void {
            background: var(--text-secondary);
            color: var(--bg-primary);
        }

        .streak-pending {
            background: var(--bg-tertiary);
            color: var(--text-secondary);
            border: 1px dashed var(--border-color);
        }

        .streak-current {
            border: 2px solid white !important;
        }

        /* ==================== METRICS ==================== */
        .metrics {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
        }

        .metric {
            background: var(--bg-tertiary);
            padding: 10px;
            border-radius: 6px;
            text-align: center;
        }

        .metric-value {
            font-size: 1.1rem;
            font-weight: bold;
        }

        .metric-label {
            font-size: 0.5rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            margin-top: 2px;
        }

        /* ==================== PENDING BETS ==================== */
        .pending-bet {
            background: var(--bg-tertiary);
            border-radius: 8px;
            padding: 10px;
            margin-bottom: 8px;
        }

        .pending-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 6px;
        }

        .pending-legs {
            margin-bottom: 8px;
        }

        .pending-leg {
            font-size: 0.7rem;
            padding: 4px 0;
            border-bottom: 1px solid var(--border-color);
        }

        .pending-leg:last-child {
            border-bottom: none;
        }

        .pending-summary {
            display: flex;
            justify-content: space-between;
            font-size: 0.75rem;
            margin-top: 6px;
        }

        /* ==================== BUTTONS ==================== */
        .btn {
            padding: 8px 14px;
            border: none;
            border-radius: 6px;
            font-size: 0.75rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--accent-green), var(--accent-blue));
            color: white;
        }

        .btn-secondary {
            background: var(--bg-tertiary);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
        }

        .btn-success {
            background: var(--accent-green);
            color: var(--bg-primary);
        }

        .btn-danger {
            background: var(--accent-red);
            color: white;
        }

        .btn-warning {
            background: var(--accent-orange);
            color: var(--bg-primary);
        }

        .btn-sm {
            padding: 4px 8px;
            font-size: 0.65rem;
        }

        .btn-group {
            display: flex;
            gap: 6px;
            margin-top: 8px;
        }

        .btn-group .btn {
            flex: 1;
        }

        /* ==================== MODAL ==================== */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.85);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 200;
            padding: 15px;
        }

        .modal.open {
            display: flex;
        }

        .modal-box {
            background: var(--bg-secondary);
            border-radius: 10px;
            padding: 16px;
            max-width: 400px;
            width: 100%;
            max-height: 85vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .modal-title {
            font-size: 1rem;
            font-weight: 600;
        }

        .modal-close {
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0;
            line-height: 1;
        }

        /* ==================== FORMS ==================== */
        .form-group {
            margin-bottom: 12px;
        }

        .form-label {
            display: block;
            font-size: 0.7rem;
            color: var(--text-secondary);
            margin-bottom: 4px;
        }

        .form-input,
        .form-select {
            width: 100%;
            padding: 10px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            color: var(--text-primary);
            font-size: 0.85rem;
        }

        .form-input:focus,
        .form-select:focus {
            outline: none;
            border-color: var(--accent-green);
        }

        /* ==================== TABLES ==================== */
        .table-wrap {
            overflow-x: auto;
            max-height: 280px;
            overflow-y: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            padding: 6px 5px;
            text-align: left;
            font-size: 0.65rem;
            border-bottom: 1px solid var(--border-color);
        }

        th {
            background: var(--bg-tertiary);
            font-size: 0.55rem;
            text-transform: uppercase;
            color: var(--text-secondary);
            position: sticky;
            top: 0;
            z-index: 5;
        }

        /* ==================== BADGES ==================== */
        .badge {
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.55rem;
            font-weight: 600;
        }

        .badge-pending {
            background: rgba(255, 159, 67, 0.2);
            color: var(--accent-orange);
        }

        .badge-won {
            background: rgba(0, 212, 170, 0.2);
            color: var(--accent-green);
        }

        .badge-lost {
            background: rgba(255, 107, 107, 0.2);
            color: var(--accent-red);
        }

        .badge-void {
            background: rgba(176, 176, 192, 0.2);
            color: var(--text-secondary);
        }

        /* ==================== UTILITIES ==================== */
        .green { color: var(--accent-green); }
        .red { color: var(--accent-red); }
        .orange { color: var(--accent-orange); }
        .blue { color: var(--accent-blue); }
        .purple { color: var(--accent-purple); }
        .yellow { color: var(--accent-yellow); }

        .empty {
            text-align: center;
            padding: 25px;
            color: var(--text-secondary);
            font-size: 0.8rem;
        }

        .empty-icon {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 30px;
        }

        .spinner {
            width: 30px;
            height: 30px;
            border: 3px solid var(--bg-tertiary);
            border-top-color: var(--accent-green);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.4; }
        }

        /* ==================== CHART ==================== */
        .chart-box {
            height: 170px;
            position: relative;
        }

        /* ==================== API STATUS ==================== */
        .api-status {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 0.6rem;
        }

        .api-dot {
            width: 7px;
            height: 7px;
            border-radius: 50%;
        }

        .api-dot.online { background: var(--accent-green); }
        .api-dot.loading { background: var(--accent-orange); animation: pulse 1s infinite; }
        .api-dot.offline { background: var(--accent-red); }

        /* ==================== NOTIFICATIONS ==================== */
        .notification {
            position: fixed;
            top: 12px;
            left: 12px;
            right: 12px;
            padding: 12px 15px;
            border-radius: 8px;
            color: white;
            font-weight: 600;
            z-index: 300;
            font-size: 0.8rem;
            text-align: center;
            animation: slideDown 0.3s ease;
        }

        @keyframes slideDown {
            from {
                transform: translateY(-100%);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .notification-success { background: var(--accent-green); color: var(--bg-primary); }
        .notification-error { background: var(--accent-red); }
        .notification-warning { background: var(--accent-orange); color: var(--bg-primary); }
        .notification-info { background: var(--accent-blue); }

        /* ==================== FULL WIDTH ==================== */
        .full-width {
            grid-column: 1 / -1;
        }

        /* ==================== RESPONSIVE ==================== */
        @media (max-width: 768px) {
            body {
                padding: 8px;
                padding-bottom: 110px;
            }
            
            .header {
                flex-direction: column;
                text-align: center;
            }
            
            .grid {
                grid-template-columns: 1fr;
            }
            
            .betslip-panel {
                max-height: 70vh;
            }
        }

        /* ==================== SCROLLBAR ==================== */
        ::-webkit-scrollbar {
            width: 5px;
            height: 5px;
        }

        ::-webkit-scrollbar-track {
            background: var(--bg-tertiary);
            border-radius: 3px;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--border-color);
            border-radius: 3px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--accent-green);
        }
    </style>
</head>
<body>
    <!-- ==================== HEADER ==================== -->
    <div class="header">
        <h1>üéØ 21-Day Betting Challenge</h1>
        <div class="header-right">
            <div class="sync-badge">
                <div class="sync-dot offline" id="syncDot"></div>
                <span id="syncText">Connecting...</span>
            </div>
            <div class="header-stats">
                <div class="header-stat">
                    <div class="header-stat-value" id="hDay">Day 3</div>
                    <div class="header-stat-label">Current Day</div>
                </div>
                <div class="header-stat">
                    <div class="header-stat-value" id="hBalance">¬£384</div>
                    <div class="header-stat-label">Balance</div>
                </div>
                <div class="header-stat">
                    <div class="header-stat-value green" id="hWinRate">100%</div>
                    <div class="header-stat-label">Win Rate</div>
                </div>
                <div class="header-stat">
                    <div class="header-stat-value" id="hStatus">üü¢</div>
                    <div class="header-stat-label">Status</div>
                </div>
            </div>
        </div>
    </div>

    <!-- ==================== QUICK STATS ==================== -->
    <div class="quick-stats">
        <div class="quick-stat">
            <div class="quick-stat-value green" id="qProfit">¬£184</div>
            <div class="quick-stat-label">Profit</div>
        </div>
        <div class="quick-stat">
            <div class="quick-stat-value blue" id="qTarget">¬£346</div>
            <div class="quick-stat-label">Target</div>
        </div>
        <div class="quick-stat">
            <div class="quick-stat-value orange" id="qAhead">+0.5</div>
            <div class="quick-stat-label">Days +/-</div>
        </div>
        <div class="quick-stat">
            <div class="quick-stat-value purple" id="qAvgOdds">1.39</div>
            <div class="quick-stat-label">Avg Odds</div>
        </div>
        <div class="quick-stat">
            <div class="quick-stat-value" id="qLeft">19</div>
            <div class="quick-stat-label">Days Left</div>
        </div>
        <div class="quick-stat">
            <div class="quick-stat-value yellow" id="qROI">92%</div>
            <div class="quick-stat-label">ROI</div>
        </div>
    </div>

    <!-- ==================== MAIN GRID ==================== -->
    <div class="grid">
        <!-- Fixtures Card -->
        <div class="card">
            <div class="card-header">
                <span class="card-title">‚öΩ Fixtures</span>
                <div class="card-actions">
                    <div class="api-status">
                        <div class="api-dot loading" id="apiDot"></div>
                        <span id="apiText">Loading...</span>
                    </div>
                    <button class="btn btn-sm btn-secondary" onclick="loadFixtures(true)">üîÑ</button>
                </div>
            </div>
            <div class="tabs" id="tabs"></div>
            <div class="fixtures-list" id="fixtures">
                <div class="loading"><div class="spinner"></div></div>
            </div>
        </div>

        <!-- Progress Card -->
        <div class="card">
            <div class="card-header">
                <span class="card-title">üìà Challenge Progress</span>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill" style="width: 4.2%">4.2%</div>
            </div>
            <div class="streak" id="streak"></div>
            <div class="metrics">
                <div class="metric">
                    <div class="metric-value green" id="mWins">2</div>
                    <div class="metric-label">Wins</div>
                </div>
                <div class="metric">
                    <div class="metric-value red" id="mLosses">0</div>
                    <div class="metric-label">Losses</div>
                </div>
                <div class="metric">
                    <div class="metric-value blue" id="mBest">Day 2</div>
                    <div class="metric-label">Best Day</div>
                </div>
                <div class="metric">
                    <div class="metric-value orange" id="mStreak">2</div>
                    <div class="metric-label">Win Streak</div>
                </div>
            </div>
        </div>

        <!-- Pending Bets Card -->
        <div class="card">
            <div class="card-header">
                <span class="card-title">‚è≥ Pending Bets</span>
            </div>
            <div id="pending">
                <div class="empty">
                    <div class="empty-icon">üì≠</div>
                    <p>No pending bets</p>
                </div>
            </div>
        </div>

        <!-- Chart Card -->
        <div class="card">
            <div class="card-header">
                <span class="card-title">üìä Balance Chart</span>
            </div>
            <div class="chart-box">
                <canvas id="chart"></canvas>
            </div>
        </div>

        <!-- History Card -->
        <div class="card full-width">
            <div class="card-header">
                <span class="card-title">üìú Bet History</span>
                <div class="card-actions">
                    <button class="btn btn-sm btn-secondary" onclick="exportData()">üì§ Export</button>
                    <button class="btn btn-sm btn-secondary" onclick="document.getElementById('importFile').click()">üì• Import</button>
                    <input type="file" id="importFile" accept=".json" style="display:none" onchange="importData(event)">
                    <button class="btn btn-sm btn-danger" onclick="resetData()">üóëÔ∏è Reset</button>
                </div>
            </div>
            <div class="table-wrap">
                <table>
                    <thead>
                        <tr>
                            <th>Day</th>
                            <th>Date</th>
                            <th>Selection</th>
                            <th>Type</th>
                            <th>Odds</th>
                            <th>Stake</th>
                            <th>Result</th>
                            <th>Returns</th>
                            <th>Balance</th>
                        </tr>
                    </thead>
                    <tbody id="history"></tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- ==================== BETSLIP TOGGLE ==================== -->
    <button class="betslip-btn" onclick="toggleSlip()">
        üé´ Betslip <span class="betslip-count" id="slipCount">0</span>
    </button>

    <!-- ==================== BETSLIP PANEL ==================== -->
    <div class="betslip-panel" id="slipPanel">
        <div class="slip-header">
            <span class="slip-title">üé´ Betslip</span>
            <span class="slip-clear" onclick="clearSlip()">Clear All</span>
        </div>
        <div id="slipLegs">
            <div class="empty">
                <div class="empty-icon">üìù</div>
                <p>Click on odds to add selections</p>
            </div>
        </div>
        <div class="slip-summary">
            <div class="slip-row">
                <span>Bet Type</span>
                <span id="slipType">-</span>
            </div>
            <div class="slip-row">
                <span>Selections</span>
                <span id="slipSelCount">0</span>
            </div>
            <div class="slip-row">
                <span>Combined Odds</span>
                <span class="green" id="slipOdds">1.00</span>
            </div>
            <div class="slip-row">
                <span>Stake ¬£</span>
                <input type="number" class="slip-input" id="slipStake" step="0.01" min="0" oninput="updateSlipReturns()">
            </div>
            <div class="slip-row total">
                <span>Potential Returns</span>
                <span class="green" id="slipReturns">¬£0.00</span>
            </div>
        </div>
        <button class="slip-submit" id="slipSubmit" onclick="placeBet()" disabled>üìù Place Bet</button>
    </div>

    <!-- ==================== RESULT MODAL ==================== -->
    <div class="modal" id="resultModal">
        <div class="modal-box">
            <div class="modal-header">
                <span class="modal-title">Record Result</span>
                <button class="modal-close" onclick="closeModal()">&times;</button>
            </div>
            <div id="modalDetails"></div>
            <div class="form-group">
                <label class="form-label">Final Score(s) - Optional</label>
                <input type="text" class="form-input" id="finalScore" placeholder="e.g., 2-1 or 3-0, 2-1">
            </div>
            <div class="btn-group">
                <button class="btn btn-success" onclick="recordResult('won')">‚úÖ WON</button>
                <button class="btn btn-danger" onclick="recordResult('lost')">‚ùå LOST</button>
            </div>
            <button class="btn btn-secondary" onclick="recordResult('void')" style="width:100%; margin-top:8px">‚ö™ VOID (Stake Returned)</button>
        </div>
    </div>

    <!-- ==================== JAVASCRIPT ==================== -->
    <script>
        // ============================================================
        // CONFIGURATION
        // ============================================================
        
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyD-MH_oSRLM53UHe2sPB4bXRjsEcXEm9IM",
            authDomain: "bet-tracker-d819b.firebaseapp.com",
            databaseURL: "https://bet-tracker-d819b-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "bet-tracker-d819b",
            storageBucket: "bet-tracker-d819b.firebasestorage.app",
            messagingSenderId: "556598232550",
            appId: "1:556598232550:web:2921e82966b16bf7520227"
        };

        // API-Football Configuration
        const API_KEY = '89d2f65b7dc64f8d0fce8468e2a8af2b';
        const API_BASE = 'https://v3.football.api-sports.io';

        // Challenge Configuration
        const INITIAL = 200;
        const MULT = 1.20;
        const DAYS = 21;
        const FINAL = INITIAL * Math.pow(MULT, DAYS);

        // Cache Configuration
        const FIXTURES_CACHE_TIME = 30 * 60 * 1000; // 30 minutes
        const ODDS_CACHE_TIME = 10 * 60 * 1000; // 10 minutes

        // Preferred Bookmakers (in order of preference)
        const PREFERRED_BOOKMAKERS = ['Bet365', 'Pinnacle', '1xBet', 'Unibet', 'William Hill', 'Betfair', 'Bwin'];

        // League Configuration
        const LEAGUES = {
            // England
            39: { name: 'Premier League', short: 'EPL', flag: 'üè¥Û†ÅßÛ†Å¢Û†Å•Û†ÅÆÛ†ÅßÛ†Åø', priority: 1 },
            40: { name: 'Championship', short: 'Champ', flag: 'üè¥Û†ÅßÛ†Å¢Û†Å•Û†ÅÆÛ†ÅßÛ†Åø', priority: 6 },
            41: { name: 'League One', short: 'L1 ENG', flag: 'üè¥Û†ÅßÛ†Å¢Û†Å•Û†ÅÆÛ†ÅßÛ†Åø', priority: 25 },
            42: { name: 'League Two', short: 'L2 ENG', flag: 'üè¥Û†ÅßÛ†Å¢Û†Å•Û†ÅÆÛ†ÅßÛ†Åø', priority: 26 },
            45: { name: 'FA Cup', short: 'FA Cup', flag: 'üè¥Û†ÅßÛ†Å¢Û†Å•Û†ÅÆÛ†ÅßÛ†Åø', priority: 30 },
            48: { name: 'EFL Cup', short: 'EFL Cup', flag: 'üè¥Û†ÅßÛ†Å¢Û†Å•Û†ÅÆÛ†ÅßÛ†Åø', priority: 31 },
            
            // Spain
            140: { name: 'La Liga', short: 'La Liga', flag: 'üá™üá∏', priority: 2 },
            141: { name: 'La Liga 2', short: 'Liga 2', flag: 'üá™üá∏', priority: 7 },
            143: { name: 'Copa del Rey', short: 'Copa', flag: 'üá™üá∏', priority: 32 },
            
            // Germany
            78: { name: 'Bundesliga', short: 'Bund', flag: 'üá©üá™', priority: 3 },
            79: { name: '2. Bundesliga', short: 'Bund 2', flag: 'üá©üá™', priority: 8 },
            81: { name: 'DFB Pokal', short: 'DFB', flag: 'üá©üá™', priority: 33 },
            
            // Italy
            135: { name: 'Serie A', short: 'Serie A', flag: 'üáÆüáπ', priority: 4 },
            136: { name: 'Serie B', short: 'Serie B', flag: 'üáÆüáπ', priority: 9 },
            137: { name: 'Coppa Italia', short: 'Coppa IT', flag: 'üáÆüáπ', priority: 34 },
            
            // France
            61: { name: 'Ligue 1', short: 'Ligue 1', flag: 'üá´üá∑', priority: 5 },
            62: { name: 'Ligue 2', short: 'Ligue 2', flag: 'üá´üá∑', priority: 10 },
            66: { name: 'Coupe de France', short: 'CdF', flag: 'üá´üá∑', priority: 35 },
            
            // Portugal
            94: { name: 'Primeira Liga', short: 'PT Liga', flag: 'üáµüáπ', priority: 11 },
            96: { name: 'Ta√ßa de Portugal', short: 'Ta√ßa', flag: 'üáµüáπ', priority: 36 },
            
            // Netherlands
            88: { name: 'Eredivisie', short: 'Ere', flag: 'üá≥üá±', priority: 12 },
            90: { name: 'KNVB Beker', short: 'KNVB', flag: 'üá≥üá±', priority: 37 },
            
            // Belgium
            144: { name: 'Jupiler Pro', short: 'BEL', flag: 'üáßüá™', priority: 13 },
            
            // Turkey
            203: { name: 'S√ºper Lig', short: 'TSL', flag: 'üáπüá∑', priority: 14 },
            206: { name: 'Turkish Cup', short: 'TR Cup', flag: 'üáπüá∑', priority: 38 },
            
            // Scotland
            179: { name: 'Premiership', short: 'SPFL', flag: 'üè¥Û†ÅßÛ†Å¢Û†Å≥Û†Å£Û†Å¥Û†Åø', priority: 15 },
            183: { name: 'Scottish Cup', short: 'SC Cup', flag: 'üè¥Û†ÅßÛ†Å¢Û†Å≥Û†Å£Û†Å¥Û†Åø', priority: 39 },
            
            // Austria
            218: { name: 'Bundesliga AT', short: 'AUT', flag: 'üá¶üáπ', priority: 16 },
            
            // Switzerland
            207: { name: 'Super League', short: 'SUI', flag: 'üá®üá≠', priority: 17 },
            
            // Greece
            197: { name: 'Super League', short: 'GRE', flag: 'üá¨üá∑', priority: 18 },
            
            // Denmark
            119: { name: 'Superliga', short: 'DEN', flag: 'üá©üá∞', priority: 19 },
            
            // Russia
            235: { name: 'Premier League', short: 'RUS', flag: 'üá∑üá∫', priority: 20 },
            
            // Ukraine
            333: { name: 'Premier League', short: 'UKR', flag: 'üá∫üá¶', priority: 21 },
            
            // Saudi Arabia
            307: { name: 'Saudi Pro League', short: 'SPL', flag: 'üá∏üá¶', priority: 22 },
            
            // European Competitions
            2: { name: 'Champions League', short: 'UCL', flag: 'üèÜ', priority: 50 },
            3: { name: 'Europa League', short: 'UEL', flag: 'üèÜ', priority: 51 },
            848: { name: 'Conference League', short: 'UECL', flag: 'üèÜ', priority: 52 },
            
            // Friendlies
            667: { name: 'Club Friendlies', short: 'Friendly', flag: '‚öΩ', priority: 100 }
        };

        // Leagues to fetch (ordered by priority)
        const FETCH_LEAGUES = [39, 140, 78, 135, 61, 48, 45, 143, 81, 137, 2, 3, 848, 40, 94, 88, 144, 203, 179, 307, 667];

        // ============================================================
        // STATE
        // ============================================================
        
        let db = null;
        let userId = null;
        let isOnline = false;
        let syncPending = false;

        // Pre-loaded with Day 1 and Day 2 results
        let data = {
            startDate: "2025-12-15",
            currentBalance: 384.42,
            bets: [
                {
                    id: 1734291600001,
                    date: "2025-12-15",
                    type: "single",
                    legs: [
                        {
                            match: "Fenerbahce vs Konyaspor",
                            selection: "Fenerbahce Win",
                            odds: 1.2857,
                            league: "Turkish Super Lig",
                            market: "home"
                        }
                    ],
                    selection: "Fenerbahce Win",
                    competition: "Turkish Super Lig",
                    odds: 1.2857,
                    stake: 200,
                    status: "won",
                    finalScore: "4-0",
                    day: 1,
                    returns: 257.14,
                    balanceAfter: 257.14,
                    targetForDay: 240,
                    vsTarget: 17.14
                },
                {
                    id: 1734378000002,
                    date: "2025-12-16",
                    type: "double",
                    legs: [
                        {
                            match: "Cardiff City vs Chelsea",
                            selection: "Chelsea Win",
                            odds: 1.30,
                            league: "EFL Cup",
                            market: "away"
                        },
                        {
                            match: "CD Guadalajara vs Barcelona",
                            selection: "Barcelona Win & Over 1.5 Goals",
                            odds: 1.15,
                            league: "Copa del Rey",
                            market: "home"
                        }
                    ],
                    selection: "Chelsea Win + Barcelona & O1.5",
                    competition: "EFL Cup / Copa del Rey",
                    odds: 1.495,
                    stake: 257.14,
                    status: "won",
                    finalScore: "1-5, 0-4",
                    day: 2,
                    returns: 384.42,
                    balanceAfter: 384.42,
                    targetForDay: 288,
                    vsTarget: 96.42
                }
            ],
            pendingBets: [],
            settings: {
                initialBalance: 200,
                dailyTarget: 1.20,
                targetDays: 21
            }
        };

        let fixtures = [];
        let fixturesCache = { data: [], time: 0 };
        let oddsCache = {};
        let slip = [];
        let currentFilter = 'all';
        let selectedBetId = null;

        // ============================================================
        // UTILITIES
        // ============================================================
        
        const sleep = ms => new Promise(r => setTimeout(r, ms));

        function notify(msg, type = 'info') {
            document.querySelectorAll('.notification').forEach(n => n.remove());
            const n = document.createElement('div');
            n.className = `notification notification-${type}`;
            n.textContent = msg;
            document.body.appendChild(n);
            setTimeout(() => n.remove(), 4000);
        }

        function log(msg, obj = null) {
            const time = new Date().toLocaleTimeString();
            if (obj) console.log(`[${time}] ${msg}`, obj);
            else console.log(`[${time}] ${msg}`);
        }

        // ============================================================
        // FIREBASE
        // ============================================================
        
        function initFirebase() {
            try {
                firebase.initializeApp(firebaseConfig);
                db = firebase.database();
                
                // Get or create user ID
                userId = localStorage.getItem('bet_userId');
                if (!userId) {
                    userId = 'user_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                    localStorage.setItem('bet_userId', userId);
                }
                
                log('Firebase initialized. User ID: ' + userId);
                
                // Listen for data changes
                db.ref(`challenges/${userId}`).on('value', (snapshot) => {
                    const cloudData = snapshot.val();
                    if (cloudData && !syncPending) {
                        // Check if cloud data is newer
                        const cloudTime = cloudData.lastUpdated || 0;
                        const localTime = data.lastUpdated || 0;
                        
                        if (cloudTime > localTime) {
                            data = cloudData;
                            log('Data synced from cloud');
                            updateUI();
                        }
                    }
                    updateSyncStatus('synced', 'Synced');
                    isOnline = true;
                });
                
                // Connection state listener
                db.ref('.info/connected').on('value', (snap) => {
                    if (snap.val() === true) {
                        updateSyncStatus('synced', 'Synced');
                        isOnline = true;
                    } else {
                        updateSyncStatus('offline', 'Offline');
                        isOnline = false;
                    }
                });
                
            } catch (e) {
                log('Firebase error:', e);
                updateSyncStatus('offline', 'Local Only');
            }
        }

        function updateSyncStatus(status, text) {
            document.getElementById('syncDot').className = `sync-dot ${status}`;
            document.getElementById('syncText').textContent = text;
        }

        function saveToCloud() {
            if (db && userId && isOnline) {
                syncPending = true;
                data.lastUpdated = Date.now();
                
                db.ref(`challenges/${userId}`).set(data)
                    .then(() => {
                        log('Saved to cloud');
                        updateSyncStatus('synced', 'Synced');
                        syncPending = false;
                    })
                    .catch(e => {
                        log('Cloud save error:', e);
                        updateSyncStatus('offline', 'Sync Error');
                        syncPending = false;
                    });
            }
        }

        // ============================================================
        // DATA MANAGEMENT
        // ============================================================
        
        function loadData() {
            // First try localStorage
            const saved = localStorage.getItem('betChallenge_v2');
            if (saved) {
                try {
                    const parsed = JSON.parse(saved);
                    // Only use if it has bets (not empty)
                    if (parsed.bets && parsed.bets.length > 0) {
                        data = parsed;
                    }
                } catch(e) {
                    log('Error parsing saved data:', e);
                }
            }
            
            // Load odds cache
            const savedOdds = localStorage.getItem('oddsCache_v2');
            if (savedOdds) {
                try {
                    oddsCache = JSON.parse(savedOdds);
                    // Clean old entries
                    const now = Date.now();
                    Object.keys(oddsCache).forEach(k => {
                        if (now - oddsCache[k].time > ODDS_CACHE_TIME) {
                            delete oddsCache[k];
                        }
                    });
                } catch(e) {
                    oddsCache = {};
                }
            }
            
            updateUI();
        }

        function saveData() {
            data.lastUpdated = Date.now();
            localStorage.setItem('betChallenge_v2', JSON.stringify(data));
            localStorage.setItem('oddsCache_v2', JSON.stringify(oddsCache));
            saveToCloud();
        }

        function exportData() {
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = `bet-tracker-backup-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            notify('Data exported successfully!', 'success');
        }

        function importData(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = ev => {
                    try {
                        data = JSON.parse(ev.target.result);
                        saveData();
                        updateUI();
                        notify('Data imported successfully!', 'success');
                    } catch(err) {
                        notify('Import failed - invalid file', 'error');
                    }
                };
                reader.readAsText(file);
            }
            e.target.value = '';
        }

        function resetData() {
            if (confirm('‚ö†Ô∏è Reset ALL data? This cannot be undone!')) {
                if (confirm('Are you absolutely sure? All progress will be lost!')) {
                    localStorage.removeItem('betChallenge_v2');
                    localStorage.removeItem('oddsCache_v2');
                    oddsCache = {};
                    
                    data = {
                        startDate: new Date().toISOString().split('T')[0],
                        currentBalance: INITIAL,
                        bets: [],
                        pendingBets: [],
                        settings: { initialBalance: INITIAL, dailyTarget: MULT, targetDays: DAYS }
                    };
                    
                    saveData();
                    updateUI();
                    notify('All data reset', 'success');
                }
            }
        }

        // ============================================================
        // API CALLS
        // ============================================================
        
        async function apiCall(endpoint) {
            try {
                const res = await fetch(`${API_BASE}${endpoint}`, {
                    headers: { 'x-apisports-key': API_KEY }
                });
                
                if (res.ok) {
                    const json = await res.json();
                    if (json.errors && Object.keys(json.errors).length > 0) {
                        log('API Error:', json.errors);
                        return null;
                    }
                    return json.response || [];
                }
                return null;
            } catch(e) {
                log('API call failed:', e);
                return null;
            }
        }

        async function loadFixtures(force = false) {
            const dot = document.getElementById('apiDot');
            const txt = document.getElementById('apiText');
            const cont = document.getElementById('fixtures');

            // Check cache
            const now = Date.now();
            if (!force && fixturesCache.data.length > 0 && (now - fixturesCache.time) < FIXTURES_CACHE_TIME) {
                const age = Math.round((now - fixturesCache.time) / 60000);
                log(`Using cached fixtures (${age}m old)`);
                dot.className = 'api-dot online';
                txt.textContent = `${fixturesCache.data.length} (cached)`;
                fixtures = fixturesCache.data;
                buildTabs();
                renderFixtures();
                return;
            }

            dot.className = 'api-dot loading';
            txt.textContent = 'Loading...';
            cont.innerHTML = '<div class="loading"><div class="spinner"></div></div>';

            fixtures = [];
            
            log('Fetching fixtures...');

            try {
                for (const lid of FETCH_LEAGUES) {
                    try {
                        const response = await apiCall(`/fixtures?league=${lid}&next=10`);
                        if (response && response.length > 0) {
                            fixtures.push(...response);
                            log(`‚úì ${LEAGUES[lid]?.short || lid}: ${response.length} fixtures`);
                        }
                    } catch(e) {
                        log(`‚úó League ${lid}: ${e.message}`);
                    }
                    await sleep(80);
                }

                // Update cache
                fixturesCache = { data: fixtures, time: Date.now() };
                
                log(`Loaded ${fixtures.length} fixtures. Now fetching odds...`);
                dot.className = 'api-dot loading';
                txt.textContent = `${fixtures.length} - Loading odds...`;

                // Fetch odds
                await loadAllOdds();

                dot.className = 'api-dot online';
                txt.textContent = fixtures.length;
                
                buildTabs();
                renderFixtures();
                saveData();

                if (fixtures.length === 0) {
                    cont.innerHTML = '<div class="empty"><div class="empty-icon">üìÖ</div><p>No fixtures found</p></div>';
                } else {
                    notify(`Loaded ${fixtures.length} fixtures with odds`, 'success');
                }

            } catch(e) {
                log('Fetch error:', e);
                dot.className = 'api-dot offline';
                txt.textContent = 'Error';
                cont.innerHTML = `
                    <div class="empty">
                        <div class="empty-icon">‚ö†Ô∏è</div>
                        <p>Failed to load fixtures</p>
                        <button class="btn btn-success" onclick="loadFixtures(true)" style="margin-top:12px">Retry</button>
                    </div>
                `;
            }
        }

        async function loadAllOdds() {
            // Group fixtures by league and date for efficient fetching
            const grouped = {};
            
            fixtures.forEach(f => {
                const date = f.fixture.date.split('T')[0];
                const league = f.league.id;
                const key = `${league}_${date}`;
                
                if (!grouped[key]) {
                    grouped[key] = { league, date, fixtureIds: [] };
                }
                grouped[key].fixtureIds.push(f.fixture.id);
            });

            log(`Fetching odds for ${Object.keys(grouped).length} league/date combinations...`);

            for (const key of Object.keys(grouped)) {
                const { league, date, fixtureIds } = grouped[key];
                
                // Check if all fixtures have cached odds
                const allCached = fixtureIds.every(fid => 
                    oddsCache[fid] && (Date.now() - oddsCache[fid].time) < ODDS_CACHE_TIME
                );
                
                if (allCached) {
                    continue;
                }
                
                try {
                    // Fetch odds for entire league/date in one call (more efficient)
                    const response = await apiCall(`/odds?league=${league}&date=${date}`);
                    
                    if (response && response.length > 0) {
                        response.forEach(oddsData => {
                            const fid = oddsData.fixture.id;
                            const parsed = parseOdds(oddsData);
                            oddsCache[fid] = { odds: parsed, time: Date.now() };
                        });
                        log(`‚úì Odds: ${LEAGUES[league]?.short || league} ${date}`);
                    }
                } catch(e) {
                    log(`‚úó Odds for league ${league}: ${e.message}`);
                }
                
                await sleep(100);
            }

            log('Odds loading complete');
        }

        function parseOdds(oddsData) {
            const result = {
                home: null,
                draw: null,
                away: null,
                over15: null,
                over25: null,
                over35: null,
                under15: null,
                under25: null,
                under35: null,
                bttsYes: null,
                bttsNo: null,
                homeOrDraw: null,
                awayOrDraw: null,
                bookmaker: null
            };

            if (!oddsData || !oddsData.bookmakers || oddsData.bookmakers.length === 0) {
                return result;
            }

            // Find preferred bookmaker
            let bookmaker = null;
            for (const pref of PREFERRED_BOOKMAKERS) {
                bookmaker = oddsData.bookmakers.find(b => b.name === pref);
                if (bookmaker) break;
            }
            
            if (!bookmaker) bookmaker = oddsData.bookmakers[0];
            result.bookmaker = bookmaker.name;

            for (const bet of bookmaker.bets) {
                switch (bet.name) {
                    case 'Match Winner':
                        bet.values.forEach(v => {
                            if (v.value === 'Home') result.home = parseFloat(v.odd);
                            if (v.value === 'Draw') result.draw = parseFloat(v.odd);
                            if (v.value === 'Away') result.away = parseFloat(v.odd);
                        });
                        break;
                        
                    case 'Goals Over/Under':
                        bet.values.forEach(v => {
                            if (v.value === 'Over 1.5') result.over15 = parseFloat(v.odd);
                            if (v.value === 'Over 2.5') result.over25 = parseFloat(v.odd);
                            if (v.value === 'Over 3.5') result.over35 = parseFloat(v.odd);
                            if (v.value === 'Under 1.5') result.under15 = parseFloat(v.odd);
                            if (v.value === 'Under 2.5') result.under25 = parseFloat(v.odd);
                            if (v.value === 'Under 3.5') result.under35 = parseFloat(v.odd);
                        });
                        break;
                        
                    case 'Both Teams Score':
                        bet.values.forEach(v => {
                            if (v.value === 'Yes') result.bttsYes = parseFloat(v.odd);
                            if (v.value === 'No') result.bttsNo = parseFloat(v.odd);
                        });
                        break;
                        
                    case 'Double Chance':
                        bet.values.forEach(v => {
                            if (v.value === 'Home/Draw') result.homeOrDraw = parseFloat(v.odd);
                            if (v.value === 'Away/Draw') result.awayOrDraw = parseFloat(v.odd);
                        });
                        break;
                }
            }

            return result;
        }

        function getOddsForFixture(fixtureId) {
            const cached = oddsCache[fixtureId];
            if (cached && (Date.now() - cached.time) < ODDS_CACHE_TIME) {
                return cached.odds;
            }
            return null;
        }

        async function loadSingleFixtureOdds(fixtureId) {
            notify('Loading odds...', 'info');
            
            try {
                const response = await apiCall(`/odds?fixture=${fixtureId}`);
                if (response && response.length > 0) {
                    const parsed = parseOdds(response[0]);
                    oddsCache[fixtureId] = { odds: parsed, time: Date.now() };
                    saveData();
                    renderFixtures();
                    notify(`Odds loaded (${parsed.bookmaker || 'Unknown'})`, 'success');
                } else {
                    notify('No odds available for this match', 'warning');
                }
            } catch(e) {
                notify('Failed to load odds', 'error');
            }
        }

        // ============================================================
        // FIXTURES DISPLAY
        // ============================================================
        
        function buildTabs() {
            const leaguesInFixtures = [...new Set(fixtures.map(f => f.league.id))];
            const tabs = document.getElementById('tabs');
            
            // Sort by priority
            leaguesInFixtures.sort((a, b) => {
                const pa = LEAGUES[a]?.priority || 999;
                const pb = LEAGUES[b]?.priority || 999;
                return pa - pb;
            });
            
            let html = `<button class="tab ${currentFilter === 'all' ? 'active' : ''}" onclick="filterLeague('all')">All (${fixtures.length})</button>`;
            
            leaguesInFixtures.forEach(lid => {
                const l = LEAGUES[lid] || { short: 'Other', flag: '‚öΩ' };
                const count = fixtures.filter(f => f.league.id === lid).length;
                html += `<button class="tab ${currentFilter == lid ? 'active' : ''}" onclick="filterLeague(${lid})">${l.flag} ${l.short} (${count})</button>`;
            });
            
            tabs.innerHTML = html;
        }

        function filterLeague(lid) {
            currentFilter = lid;
            buildTabs();
            renderFixtures();
        }

        function renderFixtures() {
            let list = currentFilter === 'all' ? fixtures : fixtures.filter(f => f.league.id === currentFilter);
            list = list.sort((a, b) => new Date(a.fixture.date) - new Date(b.fixture.date));
            
            const cont = document.getElementById('fixtures');
            
            if (!list.length) {
                cont.innerHTML = '<div class="empty"><div class="empty-icon">üìÖ</div><p>No fixtures</p></div>';
                return;
            }

            cont.innerHTML = list.map(f => {
                const fix = f.fixture;
                const teams = f.teams;
                const league = LEAGUES[f.league.id] || { short: f.league.name?.substring(0,6) || 'Other', flag: '‚öΩ', name: f.league.name };
                
                const date = new Date(fix.date);
                const dateStr = date.toLocaleDateString('en-GB', { weekday: 'short', day: '2-digit', month: 'short' });
                const timeStr = date.toLocaleTimeString('en-GB', { hour: '2-digit', minute: '2-digit' });
                
                const home = teams.home.name.replace(/'/g, "\\'");
                const away = teams.away.name.replace(/'/g, "\\'");
                const inSlip = slip.some(s => s.fixtureId === fix.id);
                
                const odds = getOddsForFixture(fix.id);
                const hasOdds = odds && odds.home;

                return `
                    <div class="match ${inSlip ? 'in-slip' : ''}" data-id="${fix.id}">
                        <div class="match-top">
                            <span class="match-league">${league.flag} ${league.short}</span>
                            <span class="match-time">${dateStr} ${timeStr}</span>
                        </div>
                        <div class="match-teams">
                            <div class="team">
                                ${teams.home.logo ? `<img src="${teams.home.logo}" class="team-logo" onerror="this.style.display='none'">` : ''}
                                <span class="team-name">${teams.home.name}</span>
                            </div>
                            <span class="match-vs">vs</span>
                            <div class="team away">
                                ${teams.away.logo ? `<img src="${teams.away.logo}" class="team-logo" onerror="this.style.display='none'">` : ''}
                                <span class="team-name">${teams.away.name}</span>
                            </div>
                        </div>
                        ${hasOdds ? `
                            <div class="odds-row">
                                <div class="odd ${isSelected(fix.id, 'home') ? 'selected' : ''}" onclick="addToSlip(${fix.id}, 'home', '${home}', '${away}', ${odds.home}, '${league.name}')">
                                    <div class="odd-label">1</div>
                                    <div class="odd-value">${odds.home.toFixed(2)}</div>
                                </div>
                                <div class="odd ${isSelected(fix.id, 'draw') ? 'selected' : ''}" onclick="addToSlip(${fix.id}, 'draw', '${home}', '${away}', ${odds.draw || 0}, '${league.name}')">
                                    <div class="odd-label">X</div>
                                    <div class="odd-value">${odds.draw ? odds.draw.toFixed(2) : '-'}</div>
                                </div>
                                <div class="odd ${isSelected(fix.id, 'away') ? 'selected' : ''}" onclick="addToSlip(${fix.id}, 'away', '${home}', '${away}', ${odds.away}, '${league.name}')">
                                    <div class="odd-label">2</div>
                                    <div class="odd-value">${odds.away.toFixed(2)}</div>
                                </div>
                            </div>
                            <div class="odds-row" style="margin-top:4px">
                                ${odds.over15 ? `
                                    <div class="odd ${isSelected(fix.id, 'o15') ? 'selected' : ''}" onclick="addToSlip(${fix.id}, 'o15', '${home}', '${away}', ${odds.over15}, '${league.name}')">
                                        <div class="odd-label">O1.5</div>
                                        <div class="odd-value">${odds.over15.toFixed(2)}</div>
                                    </div>
                                ` : ''}
                                ${odds.over25 ? `
                                    <div class="odd ${isSelected(fix.id, 'o25') ? 'selected' : ''}" onclick="addToSlip(${fix.id}, 'o25', '${home}', '${away}', ${odds.over25}, '${league.name}')">
                                        <div class="odd-label">O2.5</div>
                                        <div class="odd-value">${odds.over25.toFixed(2)}</div>
                                    </div>
                                ` : ''}
                                ${odds.under25 ? `
                                    <div class="odd ${isSelected(fix.id, 'u25') ? 'selected' : ''}" onclick="addToSlip(${fix.id}, 'u25', '${home}', '${away}', ${odds.under25}, '${league.name}')">
                                        <div class="odd-label">U2.5</div>
                                        <div class="odd-value">${odds.under25.toFixed(2)}</div>
                                    </div>
                                ` : ''}
                                ${odds.bttsYes ? `
                                    <div class="odd ${isSelected(fix.id, 'btts') ? 'selected' : ''}" onclick="addToSlip(${fix.id}, 'btts', '${home}', '${away}', ${odds.bttsYes}, '${league.name}')">
                                        <div class="odd-label">BTTS</div>
                                        <div class="odd-value">${odds.bttsYes.toFixed(2)}</div>
                                    </div>
                                ` : ''}
                            </div>
                            ${odds.bookmaker ? `<div class="bookmaker-info">via ${odds.bookmaker}</div>` : ''}
                        ` : `
                            <button class="btn btn-sm btn-secondary load-odds-btn" onclick="loadSingleFixtureOdds(${fix.id})">üìä Load Odds</button>
                        `}
                    </div>
                `;
            }).join('');
        }

        // ============================================================
        // BETSLIP
        // ============================================================
        
        function isSelected(fid, mkt) {
            return slip.some(s => s.fixtureId === fid && s.market === mkt);
        }

        function addToSlip(fid, mkt, home, away, odds, league) {
            if (!odds || odds <= 0) {
                notify('Invalid odds - please load odds first', 'warning');
                return;
            }
            
            const idx = slip.findIndex(s => s.fixtureId === fid && s.market === mkt);
            
            if (idx >= 0) {
                slip.splice(idx, 1);
            } else {
                const labels = {
                    home: `${home} Win`,
                    draw: 'Draw',
                    away: `${away} Win`,
                    o15: 'Over 1.5 Goals',
                    o25: 'Over 2.5 Goals',
                    o35: 'Over 3.5 Goals',
                    u15: 'Under 1.5 Goals',
                    u25: 'Under 2.5 Goals',
                    u35: 'Under 3.5 Goals',
                    btts: 'Both Teams to Score',
                    bttsNo: 'BTTS No',
                    homeOrDraw: 'Home or Draw (1X)',
                    awayOrDraw: 'Away or Draw (X2)'
                };
                
                slip.push({
                    fixtureId: fid,
                    market: mkt,
                    home,
                    away,
                    league,
                    selection: labels[mkt] || mkt,
                    odds: parseFloat(odds.toFixed(2)),
                    match: `${home} vs ${away}`
                });
            }
            
            updateSlip();
            renderFixtures();
        }

        function removeSlipLeg(idx) {
            slip.splice(idx, 1);
            updateSlip();
            renderFixtures();
        }

        function clearSlip() {
            slip = [];
            updateSlip();
            renderFixtures();
        }

        function updateSlip() {
            const count = document.getElementById('slipCount');
            const legs = document.getElementById('slipLegs');
            const type = document.getElementById('slipType');
            const selCount = document.getElementById('slipSelCount');
            const oddsEl = document.getElementById('slipOdds');
            const stake = document.getElementById('slipStake');
            const submit = document.getElementById('slipSubmit');

            count.textContent = slip.length;
            selCount.textContent = slip.length;

            const types = ['-', 'Single', 'Double', 'Treble', '4-Fold Acca', '5-Fold Acca', '6-Fold Acca', '7-Fold Acca', '8-Fold Acca'];
            type.textContent = types[Math.min(slip.length, 8)] || `${slip.length}-Fold Acca`;

            const combOdds = slip.reduce((a, s) => a * s.odds, 1);
            oddsEl.textContent = combOdds.toFixed(2);

            if (!stake.value || stake.value === '0') {
                stake.value = data.currentBalance.toFixed(2);
            }

            if (slip.length === 0) {
                legs.innerHTML = '<div class="empty"><div class="empty-icon">üìù</div><p>Click on odds to add selections</p></div>';
            } else {
                legs.innerHTML = slip.map((s, i) => `
                    <div class="slip-leg">
                        <button class="slip-leg-remove" onclick="removeSlipLeg(${i})">√ó</button>
                        <div class="slip-leg-match">${s.match}</div>
                        <div class="slip-leg-sel">${s.selection}</div>
                        <div class="slip-leg-odds">@ ${s.odds.toFixed(2)}</div>
                    </div>
                `).join('');
            }

            submit.disabled = slip.length === 0;
            updateSlipReturns();
        }

        function updateSlipReturns() {
            const stake = parseFloat(document.getElementById('slipStake').value) || 0;
            const combOdds = slip.reduce((a, s) => a * s.odds, 1);
            document.getElementById('slipReturns').textContent = `¬£${(stake * combOdds).toFixed(2)}`;
        }

        function toggleSlip() {
            document.getElementById('slipPanel').classList.toggle('open');
        }

        function placeBet() {
            if (slip.length === 0) return;
            
            const stake = parseFloat(document.getElementById('slipStake').value);
            if (!stake || stake <= 0) {
                notify('Please enter a valid stake', 'error');
                return;
            }
            if (stake > data.currentBalance) {
                notify('Stake exceeds your current balance!', 'error');
                return;
            }

            const combOdds = slip.reduce((a, s) => a * s.odds, 1);
            const types = ['', 'single', 'double', 'treble', 'accumulator'];

            const bet = {
                id: Date.now(),
                date: new Date().toISOString().split('T')[0],
                type: types[Math.min(slip.length, 4)] || 'accumulator',
                legs: slip.map(s => ({
                    match: s.match,
                    selection: s.selection,
                    odds: s.odds,
                    league: s.league,
                    market: s.market
                })),
                selection: slip.map(s => s.selection).join(' + '),
                competition: [...new Set(slip.map(s => s.league))].join(' / '),
                odds: parseFloat(combOdds.toFixed(2)),
                stake,
                status: 'pending'
            };

            data.pendingBets.push(bet);
            saveData();

            slip = [];
            updateSlip();
            toggleSlip();
            updateUI();
            renderFixtures();
            
            notify(`${bet.type.charAt(0).toUpperCase() + bet.type.slice(1)} placed @ ${bet.odds.toFixed(2)}!`, 'success');
        }

        // ============================================================
        // RESULTS
        // ============================================================
        
        function openModal(id) {
            selectedBetId = id;
            const bet = data.pendingBets.find(b => b.id === id);
            if (!bet) return;

            const legs = bet.legs?.map(l => `
                <div style="padding:6px 0; border-bottom:1px solid var(--border-color)">
                    <div style="font-size:0.7rem; color:var(--text-secondary)">${l.match}</div>
                    <div style="font-size:0.85rem; font-weight:600">${l.selection} @ <span class="green">${l.odds.toFixed(2)}</span></div>
                </div>
            `).join('') || `<div style="font-size:0.85rem">${bet.selection}</div>`;

            document.getElementById('modalDetails').innerHTML = `
                <div style="margin-bottom:12px">
                    <div style="display:flex; justify-content:space-between; margin-bottom:8px">
                        <span class="badge badge-pending">${bet.type}</span>
                        <span style="font-size:0.7rem; color:var(--text-secondary)">${bet.date}</span>
                    </div>
                    ${legs}
                    <div style="margin-top:12px; display:flex; justify-content:space-between; font-size:0.85rem">
                        <span>Combined Odds: <strong class="green">${bet.odds.toFixed(2)}</strong></span>
                        <span>Stake: <strong>¬£${bet.stake.toFixed(2)}</strong></span>
                    </div>
                    <div style="text-align:right; font-size:0.95rem; margin-top:6px">
                        Potential Returns: <strong class="green">¬£${(bet.stake * bet.odds).toFixed(2)}</strong>
                    </div>
                </div>
            `;

            document.getElementById('finalScore').value = '';
            document.getElementById('resultModal').classList.add('open');
        }

        function closeModal() {
            document.getElementById('resultModal').classList.remove('open');
            selectedBetId = null;
        }

        function recordResult(result) {
            const idx = data.pendingBets.findIndex(b => b.id === selectedBetId);
            if (idx === -1) return;

            const bet = data.pendingBets[idx];
            bet.status = result;
            bet.finalScore = document.getElementById('finalScore').value;
            bet.day = data.bets.length + 1;

            if (result === 'won') {
                bet.returns = bet.stake * bet.odds;
                data.currentBalance = bet.returns;
            } else if (result === 'void') {
                bet.returns = bet.stake;
                // Balance stays same for void
            } else {
                bet.returns = 0;
                data.currentBalance = 0;
            }

            bet.balanceAfter = data.currentBalance;
            bet.targetForDay = INITIAL * Math.pow(MULT, bet.day);
            bet.vsTarget = bet.balanceAfter - bet.targetForDay;

            data.bets.push(bet);
            data.pendingBets.splice(idx, 1);
            
            saveData();
            closeModal();
            updateUI();

            if (result === 'won') {
                notify(`üéâ Won! New balance: ¬£${data.currentBalance.toFixed(2)}`, 'success');
                if (data.currentBalance >= FINAL) {
                    setTimeout(() => notify('üèÜ CHALLENGE COMPLETE! Amazing!', 'success'), 1500);
                }
            } else if (result === 'void') {
                notify('Bet voided - stake returned', 'info');
            } else {
                notify('‚ùå Challenge ended. Better luck next time!', 'error');
            }
        }

        function cancelBet(id) {
            if (confirm('Cancel this pending bet?')) {
                data.pendingBets = data.pendingBets.filter(b => b.id !== id);
                saveData();
                updateUI();
                notify('Bet cancelled', 'success');
            }
        }

        // ============================================================
        // UI UPDATES
        // ============================================================
        
        function updateUI() {
            updateHeader();
            updateQuickStats();
            updateProgress();
            updatePending();
            updateHistory();
            updateChart();
            updateSlip();
        }

        function updateHeader() {
            document.getElementById('hDay').textContent = `Day ${Math.min(data.bets.length + 1, DAYS)}`;
            document.getElementById('hBalance').textContent = `¬£${data.currentBalance.toFixed(0)}`;
            
            const wins = data.bets.filter(b => b.status === 'won').length;
            const total = data.bets.filter(b => b.status !== 'void').length;
            document.getElementById('hWinRate').textContent = `${total ? Math.round(wins / total * 100) : 0}%`;
            
            const active = data.currentBalance > 0 && data.bets.length < DAYS;
            const complete = data.currentBalance >= FINAL;
            document.getElementById('hStatus').textContent = complete ? 'üèÜ' : active ? 'üü¢' : 'üî¥';
        }

        function updateQuickStats() {
            const profit = data.currentBalance - INITIAL;
            document.getElementById('qProfit').textContent = `¬£${profit.toFixed(0)}`;
            document.getElementById('qProfit').className = `quick-stat-value ${profit >= 0 ? 'green' : 'red'}`;
            
            const nextTarget = INITIAL * Math.pow(MULT, data.bets.length + 1);
            document.getElementById('qTarget').textContent = `¬£${nextTarget.toFixed(0)}`;
            
            const currentTarget = INITIAL * Math.pow(MULT, Math.max(data.bets.length, 1));
            const ahead = data.bets.length && data.currentBalance > 0
                ? Math.log(data.currentBalance / currentTarget) / Math.log(MULT)
                : 0;
            document.getElementById('qAhead').textContent = ahead >= 0 ? `+${ahead.toFixed(1)}` : ahead.toFixed(1);
            document.getElementById('qAhead').className = `quick-stat-value ${ahead >= 0 ? 'green' : 'red'}`;
            
            const avgOdds = data.bets.length
                ? (data.bets.reduce((a, b) => a + b.odds, 0) / data.bets.length).toFixed(2)
                : '1.20';
            document.getElementById('qAvgOdds').textContent = avgOdds;
            
            document.getElementById('qLeft').textContent = Math.max(0, DAYS - data.bets.length);
            
            const roi = ((data.currentBalance - INITIAL) / INITIAL * 100).toFixed(0);
            document.getElementById('qROI').textContent = `${roi}%`;
        }

        function updateProgress() {
            const pct = (data.currentBalance / FINAL) * 100;
            document.getElementById('progressFill').style.width = `${Math.max(pct, 2)}%`;
            document.getElementById('progressFill').textContent = `${pct.toFixed(1)}%`;

            let streak = '';
            for (let i = 1; i <= DAYS; i++) {
                const bet = data.bets.find(b => b.day === i);
                let cls = 'streak-day streak-pending';
                if (bet) {
                    cls = `streak-day streak-${bet.status === 'won' ? 'won' : bet.status === 'void' ? 'void' : 'lost'}`;
                }
                if (i === data.bets.length + 1) cls += ' streak-current';
                streak += `<div class="${cls}">${i}</div>`;
            }
            document.getElementById('streak').innerHTML = streak;

            document.getElementById('mWins').textContent = data.bets.filter(b => b.status === 'won').length;
            document.getElementById('mLosses').textContent = data.bets.filter(b => b.status === 'lost').length;
            
            const wonBets = data.bets.filter(b => b.status === 'won');
            document.getElementById('mBest').textContent = wonBets.length
                ? `Day ${wonBets.reduce((a, b) => (b.returns - b.stake) > (a.returns - a.stake) ? b : a).day}`
                : '-';
            
            let ws = 0;
            for (let i = data.bets.length - 1; i >= 0; i--) {
                if (data.bets[i].status === 'won') ws++;
                else break;
            }
            document.getElementById('mStreak').textContent = ws;
        }

        function updatePending() {
            const cont = document.getElementById('pending');
            
            if (!data.pendingBets.length) {
                cont.innerHTML = '<div class="empty"><div class="empty-icon">üì≠</div><p>No pending bets</p></div>';
                return;
            }
            
            cont.innerHTML = data.pendingBets.map(b => {
                const legs = b.legs?.map(l => `
                    <div class="pending-leg">
                        <strong>${l.selection}</strong> @ <span class="green">${l.odds.toFixed(2)}</span>
                        <br><span style="color:var(--text-secondary); font-size:0.6rem">${l.match}</span>
                    </div>
                `).join('') || `<div class="pending-leg">${b.selection}</div>`;
                
                return `
                    <div class="pending-bet">
                        <div class="pending-header">
                            <span class="badge badge-pending">${b.type}</span>
                            <span style="font-size:0.65rem; color:var(--text-secondary)">${b.date}</span>
                        </div>
                        <div class="pending-legs">${legs}</div>
                        <div class="pending-summary">
                            <span>@ <strong class="green">${b.odds.toFixed(2)}</strong></span>
                            <span>¬£${b.stake.toFixed(2)} ‚Üí <strong class="green">¬£${(b.stake * b.odds).toFixed(2)}</strong></span>
                        </div>
                        <div class="btn-group">
                            <button class="btn btn-sm btn-success" onclick="openModal(${b.id})">‚úÖ Result</button>
                            <button class="btn btn-sm btn-secondary" onclick="cancelBet(${b.id})">‚ùå Cancel</button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function updateHistory() {
            const cont = document.getElementById('history');
            
            if (!data.bets.length) {
                cont.innerHTML = '<tr><td colspan="9" style="text-align:center; color:var(--text-secondary); padding:20px">No bets recorded yet</td></tr>';
                return;
            }
            
            cont.innerHTML = data.bets.map(b => `
                <tr>
                    <td><strong>${b.day}</strong></td>
                    <td>${b.date}</td>
                    <td title="${b.selection}">${b.selection.length > 30 ? b.selection.substring(0, 30) + '...' : b.selection}</td>
                    <td>${b.type}</td>
                    <td><strong>${b.odds.toFixed(2)}</strong></td>
                    <td>¬£${b.stake.toFixed(0)}</td>
                    <td><span class="badge badge-${b.status}">${b.status === 'won' ? '‚úÖ Won' : b.status === 'void' ? '‚ö™ Void' : '‚ùå Lost'}</span></td>
                    <td class="${b.returns > b.stake ? 'green' : 'red'}">¬£${b.returns.toFixed(0)}</td>
                    <td><strong>¬£${b.balanceAfter.toFixed(0)}</strong></td>
                </tr>
            `).join('');
        }

        function updateChart() {
            const ctx = document.getElementById('chart');
            if (!ctx) return;
            if (window.myChart) window.myChart.destroy();

            const actual = [{ x: 0, y: INITIAL }];
            data.bets.forEach(b => actual.push({ x: b.day, y: b.balanceAfter }));

            const target = [];
            for (let i = 0; i <= DAYS; i++) {
                target.push({ x: i, y: INITIAL * Math.pow(MULT, i) });
            }

            window.myChart = new Chart(ctx, {
                type: 'line',
                data: {
                    datasets: [
                        {
                            label: 'Your Balance',
                            data: actual,
                            borderColor: '#00d4aa',
                            backgroundColor: 'rgba(0, 212, 170, 0.1)',
                            fill: true,
                            tension: 0.4,
                            pointRadius: 4,
                            pointBackgroundColor: '#00d4aa'
                        },
                        {
                            label: 'Target',
                            data: target,
                            borderColor: '#54a0ff',
                            borderDash: [5, 5],
                            fill: false,
                            tension: 0.4,
                            pointRadius: 0
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: {
                                color: '#b0b0c0',
                                font: { size: 9 }
                            }
                        }
                    },
                    scales: {
                        x: {
                            type: 'linear',
                            min: 0,
                            max: DAYS,
                            ticks: {
                                color: '#b0b0c0',
                                font: { size: 8 },
                                stepSize: 3
                            },
                            grid: { color: '#333355' }
                        },
                        y: {
                            ticks: {
                                color: '#b0b0c0',
                                font: { size: 8 },
                                callback: v => v >= 1000 ? (v / 1000).toFixed(1) + 'k' : v
                            },
                            grid: { color: '#333355' },
                            min: 0
                        }
                    }
                }
            });
        }

        // ============================================================
        // INITIALIZATION
        // ============================================================
        
        document.addEventListener('DOMContentLoaded', () => {
            log('üéØ 21-Day Betting Challenge starting...');
            log('Current date: ' + new Date().toISOString());
            
            // Load saved data first
            loadData();
            
            // Initialize Firebase for cloud sync
            initFirebase();
            
            // Load fixtures
            loadFixtures();
            
            // Set default stake
            document.getElementById('slipStake').value = data.currentBalance.toFixed(2);
            
            log('‚úÖ App initialized successfully');
            log(`üìä Day ${data.bets.length + 1} | Balance: ¬£${data.currentBalance.toFixed(2)} | Win Rate: ${data.bets.length ? Math.round(data.bets.filter(b => b.status === 'won').length / data.bets.length * 100) : 0}%`);
        });
    </script>
</body>
</html>